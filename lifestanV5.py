import telebot
from telebot import types
import sqlite3
import phonenumbers
from phonenumbers import carrier, geocoder, timezone
from datetime import datetime, timedelta
import re
import logging
import os
import requests
import json
import hashlib
import qrcode
import io
import base64
from PIL import Image
import random
import time
import string
import uuid
import socket
import whois
from email_validator import validate_email, EmailNotValidError

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('bot.log', encoding='utf-8'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
TOKEN = os.getenv('TELEGRAM_BOT_TOKEN', '8512924098:AAEM4X15mimiOGc12d68EIMHOqtVFBaqEGw')
ADMIN_IDS = [int(x) for x in os.getenv('ADMIN_IDS', '8473394476, 8561684384').split(',')]
MAX_FREE_REQUESTS = 3
CHANNEL_USERNAME = "@LifeStans"
CHANNEL_LINK = "https://t.me/LifeStans"
CURRENCY_NAME = "üí∏"
SUBSCRIPTION_REQUIRED = True
REFERRAL_BONUS = 50
PROMO_CODE_LENGTH = 8
PREMIUM_COST_1DAY = 100
PREMIUM_COST_7DAY = 500
PREMIUM_COST_30DAY = 1500

# –ü–û–í–´–®–ï–ù–ù–´–ï –¶–ï–ù–´
PHONE_CHECK_PRICE = 30  # –±—ã–ª–æ 1
EMAIL_CHECK_PRICE = 20  # –±—ã–ª–æ 2

bot = telebot.TeleBot(TOKEN)

# --- –ë–ê–ó–ê –î–ê–ù–ù–´–• ---
def init_db():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    conn = sqlite3.connect('osint.db', check_same_thread=False)
    c = conn.cursor()
    
    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    c.execute('''CREATE TABLE IF NOT EXISTS users
                 (user_id INTEGER PRIMARY KEY,
                  username TEXT,
                  first_name TEXT,
                  last_name TEXT,
                  is_premium INTEGER DEFAULT 0,
                  premium_expiry TEXT,
                  request_count INTEGER DEFAULT 0,
                  last_request_date TEXT,
                  join_date TEXT DEFAULT CURRENT_TIMESTAMP,
                  is_banned INTEGER DEFAULT 0,
                  balance INTEGER DEFAULT 100,
                  total_requests INTEGER DEFAULT 0,
                  subscribed INTEGER DEFAULT 0,
                  referral_code TEXT UNIQUE,
                  referred_by INTEGER,
                  vip_level INTEGER DEFAULT 0,
                  daily_bonus_claimed TEXT DEFAULT '')''')
    
    # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    c.execute('''CREATE TABLE IF NOT EXISTS transactions
                 (id INTEGER PRIMARY KEY AUTOINCREMENT,
                  user_id INTEGER,
                  amount INTEGER,
                  type TEXT,
                  description TEXT,
                  date TEXT DEFAULT CURRENT_TIMESTAMP)''')
    
    # –ó–∞–ø—Ä–æ—Å—ã
    c.execute('''CREATE TABLE IF NOT EXISTS requests
                 (id INTEGER PRIMARY KEY AUTOINCREMENT,
                  user_id INTEGER,
                  query_type TEXT,
                  query_data TEXT,
                  result TEXT,
                  cost INTEGER DEFAULT 1,
                  timestamp TEXT DEFAULT CURRENT_TIMESTAMP)''')
    
    # –ü—Ä–æ–º–æ–∫–æ–¥—ã
    c.execute('''CREATE TABLE IF NOT EXISTS promocodes
                 (id INTEGER PRIMARY KEY AUTOINCREMENT,
                  code TEXT UNIQUE,
                  amount INTEGER,
                  uses_total INTEGER DEFAULT 1,
                  uses_left INTEGER DEFAULT 1,
                  created_by INTEGER,
                  created_date TEXT DEFAULT CURRENT_TIMESTAMP,
                  expiry_date TEXT,
                  is_active INTEGER DEFAULT 1,
                  description TEXT)''')
    
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
    c.execute('''CREATE TABLE IF NOT EXISTS promocode_usage
                 (id INTEGER PRIMARY KEY AUTOINCREMENT,
                  user_id INTEGER,
                  promocode_id INTEGER,
                  used_date TEXT DEFAULT CURRENT_TIMESTAMP)''')
    
    # –†–µ—Ñ–µ—Ä–∞–ª—ã
    c.execute('''CREATE TABLE IF NOT EXISTS referrals
                 (id INTEGER PRIMARY KEY AUTOINCREMENT,
                  referrer_id INTEGER,
                  referred_id INTEGER,
                  bonus_paid INTEGER DEFAULT 0,
                  date TEXT DEFAULT CURRENT_TIMESTAMP)''')
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    c.execute('''CREATE TABLE IF NOT EXISTS settings
                 (key TEXT PRIMARY KEY,
                  value TEXT)''')
    
    conn.commit()
    conn.close()
    logger.info("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")

# --- –ü–û–õ–ù–ê–Ø –ë–ê–ó–ê –û–ü–ï–†–ê–¢–û–†–û–í –°–í–Ø–ó–ò ---
WORLD_OPERATORS = {
    # –†–æ—Å—Å–∏—è (–∫–æ–¥ 7)
    '7': {
        '–ú–µ–≥–∞–§–æ–Ω': ['920', '921', '922', '923', '924', '925', '926', '927', '928', '929',
                   '930', '931', '932', '933', '934', '935', '936', '937', '938', '939'],
        '–ú–¢–°': ['910', '911', '912', '913', '914', '915', '916', '917', '918', '919',
               '980', '981', '982', '983', '984', '985', '986', '987', '988', '989'],
        '–ë–∏–ª–∞–π–Ω': ['900', '902', '903', '904', '905', '906', '909', '950', '951', '952',
                  '953', '960', '961', '962', '963', '964', '965', '966', '967', '968', '969'],
        'Tele2': ['900', '901', '902', '904', '908', '950', '951', '952', '953', '958'],
        'Yota': ['995', '996'],
        '–†–æ—Å—Ç–µ–ª–µ–∫–æ–º': ['900', '901', '902', '904', '908', '950', '951', '952', '953', '958'],
        'Tinkoff Mobile': ['910', '911', '912', '913', '914', '915', '916', '917', '918', '919'],
        '–°–±–µ—Ä–ú–æ–±–∞–π–ª': ['910', '911', '912', '913', '914', '915', '916', '917', '918', '919'],
    },
    
    # –£–∫—Ä–∞–∏–Ω–∞ (–∫–æ–¥ 380)
    '380': {
        'Kyivstar': ['39', '50', '63', '66', '67', '68', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
        'Vodafone': ['39', '50', '63', '66', '67', '68', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
        'lifecell': ['39', '50', '63', '66', '67', '68', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
        '3mob': ['39', '50', '63', '66', '67', '68', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
        'People.net': ['39', '50', '63', '66', '67', '68', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
    },
    
    # –ë–µ–ª–∞—Ä—É—Å—å (–∫–æ–¥ 375)
    '375': {
        '–ú–¢–°': ['29', '33', '44'],
        'A1': ['29', '33', '44'],
        'life:)': ['25', '29', '33', '44'],
    },
    
    # –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω (–∫–æ–¥ 7) - —Ä–∞–∑–Ω—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã
    '7-KZ': {
        'Beeline KZ': ['705', '777', '701', '702', '708'],
        'Tele2 KZ': ['747', '700'],
        'Kcell': ['700', '701', '702', '705', '707', '708'],
        'Altel': ['700', '708'],
    },
    
    # –°–®–ê (–∫–æ–¥ 1)
    '1': {
        'Verizon': ['201', '202', '203', '205', '206', '207', '208', '209', '210', '212', '213', '214', '215',
                   '216', '217', '218', '219', '224', '225', '228', '229', '231', '234', '239', '240', '248',
                   '251', '252', '253', '254', '256', '260', '262', '267', '269', '270', '272', '276', '281',
                   '283', '301', '302', '303', '304', '305', '307', '308', '309', '310', '312', '313', '314',
                   '315', '316', '317', '318', '319', '320', '321', '323', '325', '327', '330', '331', '334',
                   '336', '337', '339', '340', '346', '347', '351', '352', '360', '361', '364', '380', '385',
                   '386', '401', '402', '404', '405', '406', '407', '408', '409', '410', '412', '413', '414',
                   '415', '417', '419', '423', '424', '425', '430', '432', '434', '435', '440', '443', '445',
                   '447', '458', '463', '469', '470', '475', '478', '479', '480', '484', '501', '502', '503',
                   '504', '505', '507', '508', '509', '510', '512', '513', '515', '516', '517', '518', '520',
                   '530', '531', '534', '539', '540', '541', '551', '557', '559', '561', '562', '563', '564',
                   '567', '570', '571', '573', '574', '575', '580', '585', '586', '601', '602', '603', '605',
                   '606', '607', '608', '609', '610', '612', '614', '615', '616', '617', '618', '619', '620',
                   '623', '626', '628', '629', '630', '631', '636', '641', '646', '650', '651', '657', '660',
                   '661', '662', '667', '669', '678', '681', '682', '689', '701', '702', '703', '704', '706',
                   '707', '708', '712', '713', '714', '715', '716', '717', '718', '719', '720', '724', '725',
                   '727', '730', '731', '732', '734', '737', '740', '743', '747', '754', '757', '760', '762',
                   '763', '764', '765', '769', '770', '772', '773', '774', '775', '779', '781', '785', '786',
                   '801', '802', '803', '804', '805', '806', '808', '810', '812', '813', '814', '815', '816',
                   '817', '818', '828', '830', '831', '832', '835', '838', '840', '843', '845', '847', '848',
                   '850', '854', '856', '857', '858', '859', '860', '862', '863', '864', '865', '870', '872',
                   '878', '901', '903', '904', '906', '907', '908', '909', '910', '912', '913', '914', '915',
                   '916', '917', '918', '919', '920', '925', '928', '929', '930', '931', '936', '937', '938',
                   '940', '941', '947', '949', '951', '952', '954', '956', '959', '970', '971', '972', '973',
                   '975', '978', '979', '980', '984', '985', '986', '989'],
        'AT&T': ['205', '206', '207', '208', '209', '210', '212', '213', '214', '215', '216', '217', '218',
                '219', '224', '225', '228', '229', '231', '234', '239', '240', '248', '251', '252', '253',
                '254', '256', '260', '262', '267', '269', '270', '272', '276', '281', '283', '301', '302',
                '303', '304', '305', '307', '308', '309', '310', '312', '313', '314', '315', '316', '317',
                '318', '319', '320', '321', '323', '325', '327', '330', '331', '334', '336', '337', '339',
                '340', '346', '347', '351', '352', '360', '361', '364', '380', '385', '386', '401', '402',
                '404', '405', '406', '407', '408', '409', '410', '412', '413', '414', '415', '417', '419',
                '423', '424', '425', '430', '432', '434', '435', '440', '443', '445', '447', '458', '463',
                '469', '470', '475', '478', '479', '480', '484', '501', '502', '503', '504', '505', '507',
                '508', '509', '510', '512', '513', '515', '516', '517', '518', '520', '530', '531', '534',
                '539', '540', '541', '551', '557', '559', '561', '562', '563', '564', '567', '570', '571',
                '573', '574', '575', '580', '585', '586', '601', '602', '603', '605', '606', '607', '608',
                '609', '610', '612', '614', '615', '616', '617', '618', '619', '620', '623', '626', '628',
                '629', '630', '631', '636', '641', '646', '650', '651', '657', '660', '661', '662', '667',
                '669', '678', '681', '682', '689', '701', '702', '703', '704', '706', '707', '708', '712',
                '713', '714', '715', '716', '717', '718', '719', '720', '724', '725', '727', '730', '731',
                '732', '734', '737', '740', '743', '747', '754', '757', '760', '762', '763', '764', '765',
                '769', '770', '772', '773', '774', '775', '779', '781', '785', '786', '801', '802', '803',
                '804', '805', '806', '808', '810', '812', '813', '814', '815', '816', '817', '818', '828',
                '830', '831', '832', '835', '838', '840', '843', '845', '847', '848', '850', '854', '856',
                '857', '858', '859', '860', '862', '863', '864', '865', '870', '872', '878', '901', '903',
                '904', '906', '907', '908', '909', '910', '912', '913', '914', '915', '916', '917', '918',
                '919', '920', '925', '928', '929', '930', '931', '936', '937', '938', '940', '941', '947',
                '949', '951', '952', '954', '956', '959', '970', '971', '972', '973', '975', '978', '979',
                '980', '984', '985', '986', '989'],
        'T-Mobile': ['205', '206', '207', '208', '209', '210', '212', '213', '214', '215', '216', '217', '218',
                    '219', '224', '225', '228', '229', '231', '234', '239', '240', '248', '251', '252', '253',
                    '254', '256', '260', '262', '267', '269', '270', '272', '276', '281', '283', '301', '302',
                    '303', '304', '305', '307', '308', '309', '310', '312', '313', '314', '315', '316', '317',
                    '318', '319', '320', '321', '323', '325', '327', '330', '331', '334', '336', '337', '339',
                    '340', '346', '347', '351', '352', '360', '361', '364', '380', '385', '386', '401', '402',
                    '404', '405', '406', '407', '408', '409', '410', '412', '413', '414', '415', '417', '419',
                    '423', '424', '425', '430', '432', '434', '435', '440', '443', '445', '447', '458', '463',
                    '469', '470', '475', '478', '479', '480', '484', '501', '502', '503', '504', '505', '507',
                    '508', '509', '510', '512', '513', '515', '516', '517', '518', '520', '530', '531', '534',
                    '539', '540', '541', '551', '557', '559', '561', '562', '563', '564', '567', '570', '571',
                    '573', '574', '575', '580', '585', '586', '601', '602', '603', '605', '606', '607', '608',
                    '609', '610', '612', '614', '615', '616', '617', '618', '619', '620', '623', '626', '628',
                    '629', '630', '631', '636', '641', '646', '650', '651', '657', '660', '661', '662', '667',
                    '669', '678', '681', '682', '689', '701', '702', '703', '704', '706', '707', '708', '712',
                    '713', '714', '715', '716', '717', '718', '719', '720', '724', '725', '727', '730', '731',
                    '732', '734', '737', '740', '743', '747', '754', '757', '760', '762', '763', '764', '765',
                    '769', '770', '772', '773', '774', '775', '779', '781', '785', '786', '801', '802', '803',
                    '804', '805', '806', '808', '810', '812', '813', '814', '815', '816', '817', '818', '828',
                    '830', '831', '832', '835', '838', '840', '843', '845', '847', '848', '850', '854', '856',
                    '857', '858', '859', '860', '862', '863', '864', '865', '870', '872', '878', '901', '903',
                    '904', '906', '907', '908', '909', '910', '912', '913', '914', '915', '916', '917', '918',
                    '919', '920', '925', '928', '929', '930', '931', '936', '937', '938', '940', '941', '947',
                    '949', '951', '952', '954', '956', '959', '970', '971', '972', '973', '975', '978', '979',
                    '980', '984', '985', '986', '989'],
        'Sprint': ['201', '202', '203', '205', '206', '207', '208', '209', '210', '212', '213', '214', '215',
                  '216', '217', '218', '219', '224', '225', '228', '229', '231', '234', '239', '240', '248',
                  '251', '252', '253', '254', '256', '260', '262', '267', '269', '270', '272', '276', '281',
                  '283', '301', '302', '303', '304', '305', '307', '308', '309', '310', '312', '313', '314',
                  '315', '316', '317', '318', '319', '320', '321', '323', '325', '327', '330', '331', '334',
                  '336', '337', '339', '340', '346', '347', '351', '352', '360', '361', '364', '380', '385',
                  '386', '401', '402', '404', '405', '406', '407', '408', '409', '410', '412', '413', '414',
                  '415', '417', '419', '423', '424', '425', '430', '432', '434', '435', '440', '443', '445',
                  '447', '458', '463', '469', '470', '475', '478', '479', '480', '484', '501', '502', '503',
                  '504', '505', '507', '508', '509', '510', '512', '513', '515', '516', '517', '518', '520',
                  '530', '531', '534', '539', '540', '541', '551', '557', '559', '561', '562', '563', '564',
                  '567', '570', '571', '573', '574', '575', '580', '585', '586', '601', '602', '603', '605',
                  '606', '607', '608', '609', '610', '612', '614', '615', '616', '617', '618', '619', '620',
                  '623', '626', '628', '629', '630', '631', '636', '641', '646', '650', '651', '657', '660',
                  '661', '662', '667', '669', '678', '681', '682', '689', '701', '702', '703', '704', '706',
                  '707', '708', '712', '713', '714', '715', '716', '717', '718', '719', '720', '724', '725',
                  '727', '730', '731', '732', '734', '737', '740', '743', '747', '754', '757', '760', '762',
                  '763', '764', '765', '769', '770', '772', '773', '774', '775', '779', '781', '785', '786',
                  '801', '802', '803', '804', '805', '806', '808', '810', '812', '813', '814', '815', '816',
                  '817', '818', '828', '830', '831', '832', '835', '838', '840', '843', '845', '847', '848',
                  '850', '854', '856', '857', '858', '859', '860', '862', '863', '864', '865', '870', '872',
                  '878', '901', '903', '904', '906', '907', '908', '909', '910', '912', '913', '914', '915',
                  '916', '917', '918', '919', '920', '925', '928', '929', '930', '931', '936', '937', '938',
                  '940', '941', '947', '949', '951', '952', '954', '956', '959', '970', '971', '972', '973',
                  '975', '978', '979', '980', '984', '985', '986', '989'],
    },
    
    # –ö–∏—Ç–∞–π (–∫–æ–¥ 86)
    '86': {
        'China Mobile': ['134', '135', '136', '137', '138', '139', '144', '147', '148', '150', '151', '152',
                        '157', '158', '159', '165', '172', '178', '182', '183', '184', '187', '188', '198'],
        'China Unicom': ['130', '131', '132', '145', '146', '155', '156', '166', '167', '171', '175', '176',
                        '185', '186', '196'],
        'China Telecom': ['133', '149', '153', '173', '174', '177', '180', '181', '189', '190', '191', '193',
                         '199'],
    },
    
    # –ì–µ—Ä–º–∞–Ω–∏—è (–∫–æ–¥ 49)
    '49': {
        'Telekom': ['151', '152', '157', '159', '160', '162', '163', '170', '171', '172', '173', '174', '175',
                   '176', '177', '178', '179'],
        'Vodafone': ['151', '152', '157', '159', '160', '162', '163', '170', '171', '172', '173', '174', '175',
                    '176', '177', '178', '179'],
        'O2': ['151', '152', '157', '159', '160', '162', '163', '170', '171', '172', '173', '174', '175',
              '176', '177', '178', '179'],
    },
    
    # –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è (–∫–æ–¥ 44)
    '44': {
        'EE': ['744', '745', '746', '747', '748', '749', '750', '751', '752', '753', '754', '755', '756',
              '757', '758', '759'],
        'O2': ['770', '771', '772', '773', '774', '775', '776', '777', '778', '779'],
        'Vodafone': ['744', '745', '746', '747', '748', '749', '750', '751', '752', '753', '754', '755',
                    '756', '757', '758', '759'],
        'Three': ['743', '744', '745', '746', '747', '748', '749'],
    },
    
    # –¢—É—Ä—Ü–∏—è (–∫–æ–¥ 90)
    '90': {
        'Turkcell': ['530', '531', '532', '533', '534', '535', '536', '537', '538', '539'],
        'Vodafone': ['540', '541', '542', '543', '544', '545', '546', '547', '548', '549'],
        'T√ºrk Telekom': ['501', '502', '503', '504', '505', '506', '507', '508', '509'],
    },
    
    # –ò–Ω–¥–∏—è (–∫–æ–¥ 91)
    '91': {
        'Airtel': ['740', '741', '742', '743', '744', '745', '746', '747', '748', '749',
                  '990', '991', '992', '993', '994', '995', '996', '997', '998', '999'],
        'Vodafone Idea': ['700', '701', '702', '703', '704', '705', '706', '707', '708', '709',
                         '750', '751', '752', '753', '754', '755', '756', '757', '758', '759'],
        'Jio': ['600', '601', '602', '603', '604', '605', '606', '607', '608', '609',
               '650', '651', '652', '653', '654', '655', '656', '657', '658', '659'],
        'BSNL': ['940', '941', '942', '943', '944', '945', '946', '947', '948', '949',
                '980', '981', '982', '983', '984', '985', '986', '987', '988', '989'],
    },
    
    # –ë—Ä–∞–∑–∏–ª–∏—è (–∫–æ–¥ 55)
    '55': {
        'Vivo': ['15', '16', '17', '18', '19'],
        'Claro': ['21', '22', '24'],
        'TIM': ['31', '32', '33'],
        'Oi': ['14', '31', '41'],
        'Nextel': ['77', '78', '79'],
    },
    
    # –ú–µ–∫—Å–∏–∫–∞ (–∫–æ–¥ 52)
    '52': {
        'Telcel': ['044', '045'],
        'Movistar': ['044', '045'],
        'AT&T Mexico': ['044', '045'],
        'Unefon': ['044', '045'],
    },
    
    # –ò—Ç–∞–ª–∏—è (–∫–æ–¥ 39)
    '39': {
        'TIM': ['320', '321', '322', '323', '324', '325', '326', '327', '328', '329',
               '330', '331', '332', '333', '334', '335', '336', '337', '338', '339'],
        'Vodafone': ['340', '341', '342', '343', '344', '345', '346', '347', '348', '349',
                    '350', '351', '352', '353', '354', '355', '356', '357', '358', '359'],
        'Wind Tre': ['360', '361', '362', '363', '364', '365', '366', '367', '368', '369',
                    '380', '381', '382', '383', '384', '385', '386', '387', '388', '389'],
        'Iliad': ['390', '391', '392', '393', '394', '395', '396', '397', '398', '399'],
    },
    
    # –§—Ä–∞–Ω—Ü–∏—è (–∫–æ–¥ 33)
    '33': {
        'Orange': ['6', '7'],
        'SFR': ['6', '7'],
        'Bouygues Telecom': ['6', '7'],
        'Free Mobile': ['6', '7'],
    },
    
    # –ò—Å–ø–∞–Ω–∏—è (–∫–æ–¥ 34)
    '34': {
        'Movistar': ['6'],
        'Vodafone': ['6'],
        'Orange': ['6'],
        'Yoigo': ['6'],
    },
    
    # –ü–æ–ª—å—à–∞ (–∫–æ–¥ 48)
    '48': {
        'Orange': ['50', '51', '53', '54', '55', '57', '58', '59'],
        'T-Mobile': ['50', '51', '53', '54', '55', '57', '58', '59'],
        'Play': ['50', '51', '53', '54', '55', '57', '58', '59'],
        'Plus': ['50', '51', '53', '54', '55', '57', '58', '59'],
    },
    
    # –Ø–ø–æ–Ω–∏—è (–∫–æ–¥ 81)
    '81': {
        'NTT Docomo': ['090', '080', '070'],
        'au': ['090', '080', '070'],
        'SoftBank': ['090', '080', '070'],
        'Rakuten Mobile': ['090', '080', '070'],
    },
    
    # –Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è (–∫–æ–¥ 82)
    '82': {
        'SK Telecom': ['010'],
        'KT': ['010'],
        'LG U+': ['010'],
    },
    
    # –ò–Ω–¥–æ–Ω–µ–∑–∏—è (–∫–æ–¥ 62)
    '62': {
        'Telkomsel': ['0811', '0812', '0813', '0821', '0822', '0823', '0852', '0853', '0851'],
        'Indosat': ['0814', '0815', '0816', '0855', '0856', '0857', '0858'],
        'XL Axiata': ['0817', '0818', '0819', '0859', '0877', '0878'],
        '3': ['0895', '0896', '0897', '0898', '0899'],
    },
    
    # –ï–≥–∏–ø–µ—Ç (–∫–æ–¥ 20)
    '20': {
        'Vodafone Egypt': ['010'],
        'Orange Egypt': ['012'],
        'Etisalat Egypt': ['011'],
        'WE': ['015'],
    },
    
    # –°–∞—É–¥–æ–≤—Å–∫–∞—è –ê—Ä–∞–≤–∏—è (–∫–æ–¥ 966)
    '966': {
        'STC': ['050', '051', '052', '053', '054', '055', '056', '057', '058', '059'],
        'Mobily': ['050', '051', '052', '053', '054', '055', '056', '057', '058', '059'],
        'Zain': ['050', '051', '052', '053', '054', '055', '056', '057', '058', '059'],
    },
    
    # –û–ê–≠ (–∫–æ–¥ 971)
    '971': {
        'Etisalat': ['050', '055', '056', '058'],
        'du': ['050', '055', '056', '058'],
    },
    
    # –ò–∑—Ä–∞–∏–ª—å (–∫–æ–¥ 972)
    '972': {
        'Cellcom': ['052', '053', '054', '055', '056', '057', '058', '059'],
        'Partner': ['050', '051', '052', '053', '054', '055', '056', '057', '058', '059'],
        'Pelephone': ['050', '051', '052', '053', '054', '055', '056', '057', '058', '059'],
    },
    
    # –Æ–ê–† (–∫–æ–¥ 27)
    '27': {
        'Vodacom': ['082'],
        'MTN': ['083'],
        'Cell C': ['084'],
        'Telkom': ['081'],
    },
    
    # –ê–≤—Å—Ç—Ä–∞–ª–∏—è (–∫–æ–¥ 61)
    '61': {
        'Telstra': ['04'],
        'Optus': ['04'],
        'Vodafone': ['04'],
        'Virgin Mobile': ['04'],
    },
    
    # –ö–∞–Ω–∞–¥–∞ (–∫–æ–¥ 1)
    '1-CA': {
        'Rogers': ['416', '647', '437'],
        'Bell': ['416', '647', '437'],
        'Telus': ['416', '647', '437'],
        'Fido': ['416', '647', '437'],
    },
    
    # –ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã (–∫–æ–¥ 31)
    '31': {
        'KPN': ['06'],
        'Vodafone': ['06'],
        'T-Mobile': ['06'],
        'Tele2': ['06'],
    },
    
    # –®–≤–µ—Ü–∏—è (–∫–æ–¥ 46)
    '46': {
        'Telia': ['070', '072', '076'],
        'Tele2': ['072', '073', '076'],
        'Telenor': ['070', '072', '076'],
        '3': ['073', '076'],
    },
    
    # –ù–æ—Ä–≤–µ–≥–∏—è (–∫–æ–¥ 47)
    '47': {
        'Telenor': ['90', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
        'Telia': ['90', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
        'Ice': ['90', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
    },
    
    # –î–∞–Ω–∏—è (–∫–æ–¥ 45)
    '45': {
        'TDC': ['20', '21', '22', '23', '24', '25', '26', '27', '28', '29'],
        'Telenor': ['20', '21', '22', '23', '24', '25', '26', '27', '28', '29'],
        '3': ['30', '31', '32', '33', '34', '35', '36', '37', '38', '39'],
    },
    
    # –§–∏–Ω–ª—è–Ω–¥–∏—è (–∫–æ–¥ 358)
    '358': {
        'Elisa': ['040', '041', '042', '043', '044', '045', '046', '047', '048', '049'],
        'DNA': ['040', '041', '042', '043', '044', '045', '046', '047', '048', '049'],
        'Telia': ['040', '041', '042', '043', '044', '045', '046', '047', '048', '049'],
    },
    
    # –®–≤–µ–π—Ü–∞—Ä–∏—è (–∫–æ–¥ 41)
    '41': {
        'Swisscom': ['076', '077', '078', '079'],
        'Sunrise': ['076', '077', '078', '079'],
        'Salt': ['076', '077', '078', '079'],
    },
    
    # –ê–≤—Å—Ç—Ä–∏—è (–∫–æ–¥ 43)
    '43': {
        'A1': ['0660', '0661', '0662', '0663', '0664'],
        'T-Mobile': ['0660', '0661', '0662', '0663', '0664'],
        'Drei': ['0660', '0661', '0662', '0663', '0664'],
    },
    
    # –ë–µ–ª—å–≥–∏—è (–∫–æ–¥ 32)
    '32': {
        'Proximus': ['0470', '0471', '0472', '0473', '0474', '0475', '0476', '0477', '0478', '0479'],
        'Orange': ['0460', '0461', '0462', '0463', '0464', '0465', '0466', '0467', '0468', '0469'],
        'Base': ['0480', '0481', '0482', '0483', '0484', '0485', '0486', '0487', '0488', '0489'],
    },
    
    # –ü–æ—Ä—Ç—É–≥–∞–ª–∏—è (–∫–æ–¥ 351)
    '351': {
        'Vodafone': ['91', '92', '93', '96'],
        'MEO': ['91', '92', '93', '96'],
        'NOS': ['91', '92', '93', '96'],
    },
    
    # –ì—Ä–µ—Ü–∏—è (–∫–æ–¥ 30)
    '30': {
        'Cosmote': ['690', '691', '692', '693', '694', '695', '696', '697', '698', '699'],
        'Vodafone': ['690', '691', '692', '693', '694', '695', '696', '697', '698', '699'],
        'Wind': ['690', '691', '692', '693', '694', '695', '696', '697', '698', '699'],
    },
    
    # –ß–µ—Ö–∏—è (–∫–æ–¥ 420)
    '420': {
        'O2': ['72', '73', '74', '75', '76', '77', '78', '79'],
        'T-Mobile': ['72', '73', '74', '75', '76', '77', '78', '79'],
        'Vodafone': ['72', '73', '74', '75', '76', '77', '78', '79'],
    },
    
    # –í–µ–Ω–≥—Ä–∏—è (–∫–æ–¥ 36)
    '36': {
        'Telekom': ['20', '30', '70'],
        'Telenor': ['20', '30', '70'],
        'Vodafone': ['20', '30', '70'],
    },
    
    # –†—É–º—ã–Ω–∏—è (–∫–æ–¥ 40)
    '40': {
        'Vodafone': ['72', '73', '74', '75', '76', '77', '78', '79'],
        'Orange': ['72', '73', '74', '75', '76', '77', '78', '79'],
        'Telekom': ['72', '73', '74', '75', '76', '77', '78', '79'],
    },
    
    # –ë–æ–ª–≥–∞—Ä–∏—è (–∫–æ–¥ 359)
    '359': {
        'Vivacom': ['87', '88', '89'],
        'A1': ['87', '88', '89'],
        'Telenor': ['87', '88', '89'],
    },
    
    # –°–µ—Ä–±–∏—è (–∫–æ–¥ 381)
    '381': {
        'Telekom Srbija': ['60', '61', '62', '63', '64', '65', '66', '67', '68', '69'],
        'Telenor': ['60', '61', '62', '63', '64', '65', '66', '67', '68', '69'],
        'Vip': ['60', '61', '62', '63', '64', '65', '66', '67', '68', '69'],
    },
    
    # –•–æ—Ä–≤–∞—Ç–∏—è (–∫–æ–¥ 385)
    '385': {
        'T-Mobile': ['91', '92', '95', '97', '98'],
        'Vip': ['91', '92', '95', '97', '98'],
        'Tele2': ['91', '92', '95', '97', '98'],
    },
    
    # –°–ª–æ–≤–∞–∫–∏—è (–∫–æ–¥ 421)
    '421': {
        'Orange': ['90', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
        'Telekom': ['90', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
        'O2': ['90', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
    },
    
    # –°–ª–æ–≤–µ–Ω–∏—è (–∫–æ–¥ 386)
    '386': {
        'Telekom': ['040', '041', '042', '043', '044', '045', '046', '047', '048', '049'],
        'A1': ['040', '041', '042', '043', '044', '045', '046', '047', '048', '049'],
        'Telemach': ['040', '041', '042', '043', '044', '045', '046', '047', '048', '049'],
    },
    
    # –õ–∏—Ç–≤–∞ (–∫–æ–¥ 370)
    '370': {
        'Telia': ['60', '61', '62', '63', '64', '65', '66', '67', '68', '69'],
        'Bitƒó': ['60', '61', '62', '63', '64', '65', '66', '67', '68', '69'],
        'Tele2': ['60', '61', '62', '63', '64', '65', '66', '67', '68', '69'],
    },
    
    # –õ–∞—Ç–≤–∏—è (–∫–æ–¥ 371)
    '371': {
        'LMT': ['20', '21', '22', '23', '24', '25', '26', '27', '28', '29'],
        'Tele2': ['20', '21', '22', '23', '24', '25', '26', '27', '28', '29'],
        'Bite': ['20', '21', '22', '23', '24', '25', '26', '27', '28', '29'],
    },
    
    # –≠—Å—Ç–æ–Ω–∏—è (–∫–æ–¥ 372)
    '372': {
        'Telia': ['50', '51', '52', '53', '54', '55', '56', '57', '58', '59'],
        'Elisa': ['50', '51', '52', '53', '54', '55', '56', '57', '58', '59'],
        'Tele2': ['50', '51', '52', '53', '54', '55', '56', '57', '58', '59'],
    },
    
    # –ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞ (–∫–æ–¥ 54)
    '54': {
        'Movistar': ['11', '221', '223', '261', '264', '266', '299', '341', '343', '351',
                    '356', '362', '370', '376', '379', '381', '383', '385', '387'],
        'Claro': ['11', '221', '223', '261', '264', '266', '299', '341', '343', '351',
                 '356', '362', '370', '376', '379', '381', '383', '385', '387'],
        'Personal': ['11', '221', '223', '261', '264', '266', '299', '341', '343', '351',
                    '356', '362', '370', '376', '379', '381', '383', '385', '387'],
    },
    
    # –ö–æ–ª—É–º–±–∏—è (–∫–æ–¥ 57)
    '57': {
        'Claro': ['300', '301', '302', '303', '304', '305', '310', '311', '312', '313',
                 '314', '315', '316', '317', '318', '319', '320', '321', '322', '323'],
        'Movistar': ['300', '301', '302', '303', '304', '305', '310', '311', '312', '313',
                    '314', '315', '316', '317', '318', '319', '320', '321', '322', '323'],
        'Tigo': ['300', '301', '302', '303', '304', '305', '310', '311', '312', '313',
                '314', '315', '316', '317', '318', '319', '320', '321', '322', '323'],
    },
    
    # –ß–∏–ª–∏ (–∫–æ–¥ 56)
    '56': {
        'Movistar': ['9'],
        'Entel': ['9'],
        'Claro': ['9'],
        'WOM': ['9'],
    },
    
    # –ü–µ—Ä—É (–∫–æ–¥ 51)
    '51': {
        'Movistar': ['9'],
        'Claro': ['9'],
        'Entel': ['9'],
        'Bitel': ['9'],
    },
    
    # –í–µ–Ω–µ—Å—É—ç–ª–∞ (–∫–æ–¥ 58)
    '58': {
        'Movistar': ['414', '424', '416', '426'],
        'Digitel': ['412'],
        'Movilnet': ['416', '426'],
    },
    
    # –ü–∞–∫–∏—Å—Ç–∞–Ω (–∫–æ–¥ 92)
    '92': {
        'Jazz': ['300', '301', '302', '303', '304', '305', '306', '307', '308', '309'],
        'Telenor': ['340', '341', '342', '343', '344', '345', '346', '347', '348', '349'],
        'Zong': ['310', '311', '312', '313', '314', '315', '316', '317', '318', '319'],
        'Ufone': ['330', '331', '332', '333', '334', '335', '336', '337', '338', '339'],
    },
    
    # –ë–∞–Ω–≥–ª–∞–¥–µ—à (–∫–æ–¥ 880)
    '880': {
        'Grameenphone': ['17', '13'],
        'Banglalink': ['19', '14'],
        'Robi': ['18', '16'],
        'Airtel': ['15'],
    },
    
    # –§–∏–ª–∏–ø–ø–∏–Ω—ã (–∫–æ–¥ 63)
    '63': {
        'Globe': ['905', '906', '915', '916', '917', '926', '927', '935', '936', '937',
                 '945', '955', '956', '965', '966', '975', '976', '977', '978', '979',
                 '995', '996', '997'],
        'Smart': ['908', '909', '910', '912', '918', '919', '920', '921', '928', '929',
                 '930', '938', '939', '946', '947', '948', '949', '950', '951', '961',
                 '998', '999'],
        'Sun Cellular': ['922', '923', '925', '932', '933', '942', '943'],
    },
    
    # –í—å–µ—Ç–Ω–∞–º (–∫–æ–¥ 84)
    '84': {
        'Viettel': ['96', '97', '98', '162', '163', '164', '165', '166', '167', '168',
                   '169', '868', '869', '96', '97', '98'],
        'Vinaphone': ['91', '94', '123', '124', '125', '127', '129', '81', '82', '83',
                     '84', '85', '86', '88', '89'],
        'Mobifone': ['90', '93', '120', '121', '122', '126', '128', '70', '76', '77',
                    '78', '79', '70', '76', '77', '78', '79'],
    },
    
    # –¢–∞–∏–ª–∞–Ω–¥ (–∫–æ–¥ 66)
    '66': {
        'AIS': ['81', '82', '83', '84', '85', '86', '87', '88', '89', '90',
               '91', '92', '93', '94', '95', '96', '97', '98', '99'],
        'DTAC': ['61', '62', '63', '64', '65', '66', '67', '68', '69', '70',
                '71', '72', '73', '74', '75', '76', '77', '78', '79'],
        'TrueMove': ['80', '81', '82', '83', '84', '85', '86', '87', '88', '89',
                    '90', '91', '92', '93', '94', '95', '96', '97', '98', '99'],
    },
    
    # –ú–∞–ª–∞–π–∑–∏—è (–∫–æ–¥ 60)
    '60': {
        'Maxis': ['12', '13', '14', '17', '19'],
        'Celcom': ['13', '19', '11', '14'],
        'Digi': ['16', '17', '19', '10'],
        'U Mobile': ['18', '19'],
    },
    
    # –°–∏–Ω–≥–∞–ø—É—Ä (–∫–æ–¥ 65)
    '65': {
        'Singtel': ['8', '9'],
        'StarHub': ['8', '9'],
        'M1': ['8', '9'],
    },
    
    # –ù–æ–≤–∞—è –ó–µ–ª–∞–Ω–¥–∏—è (–∫–æ–¥ 64)
    '64': {
        'Spark': ['2', '21', '22', '27', '28', '29'],
        'Vodafone': ['2', '21', '22', '27', '28', '29'],
        '2degrees': ['2', '21', '22', '27', '28', '29'],
    },
    
    # –ò—Ä–ª–∞–Ω–¥–∏—è (–∫–æ–¥ 353)
    '353': {
        'Vodafone': ['83', '85', '86', '87', '89'],
        'Three': ['83', '85', '86', '87', '89'],
        'Eir': ['83', '85', '86', '87', '89'],
    },
    
    # –ò—Ä–∞–Ω (–∫–æ–¥ 98)
    '98': {
        'MCI': ['910', '911', '912', '913', '914', '915', '916', '917', '918', '919',
               '990', '991', '992', '993', '994', '995', '996', '997', '998', '999'],
        'MTN Irancell': ['930', '931', '932', '933', '934', '935', '936', '937', '938', '939'],
        'Rightel': ['920', '921', '922', '923', '924', '925', '926', '927', '928', '929'],
    },
}

# –ù–∞–∑–≤–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
COUNTRY_NAMES = {
    'RU': '–†–æ—Å—Å–∏—è', 'US': '–°–®–ê', 'GB': '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è', 'DE': '–ì–µ—Ä–º–∞–Ω–∏—è',
    'FR': '–§—Ä–∞–Ω—Ü–∏—è', 'IT': '–ò—Ç–∞–ª–∏—è', 'ES': '–ò—Å–ø–∞–Ω–∏—è', 'UA': '–£–∫—Ä–∞–∏–Ω–∞',
    'BY': '–ë–µ–ª–∞—Ä—É—Å—å', 'KZ': '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω', 'CN': '–ö–∏—Ç–∞–π', 'JP': '–Ø–ø–æ–Ω–∏—è',
    'KR': '–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è', 'IN': '–ò–Ω–¥–∏—è', 'BR': '–ë—Ä–∞–∑–∏–ª–∏—è', 'MX': '–ú–µ–∫—Å–∏–∫–∞',
    'TR': '–¢—É—Ä—Ü–∏—è', 'PL': '–ü–æ–ª—å—à–∞', 'ID': '–ò–Ω–¥–æ–Ω–µ–∑–∏—è', 'EG': '–ï–≥–∏–ø–µ—Ç',
    'SA': '–°–∞—É–¥–æ–≤—Å–∫–∞—è –ê—Ä–∞–≤–∏—è', 'AE': '–û–ê–≠', 'IL': '–ò–∑—Ä–∞–∏–ª—å', 'ZA': '–Æ–ê–†',
    'AU': '–ê–≤—Å—Ç—Ä–∞–ª–∏—è', 'CA': '–ö–∞–Ω–∞–¥–∞', 'NL': '–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã', 'SE': '–®–≤–µ—Ü–∏—è',
    'NO': '–ù–æ—Ä–≤–µ–≥–∏—è', 'FI': '–§–∏–Ω–ª—è–Ω–¥–∏—è', 'DK': '–î–∞–Ω–∏—è', 'CH': '–®–≤–µ–π—Ü–∞—Ä–∏—è',
    'AT': '–ê–≤—Å—Ç—Ä–∏—è', 'BE': '–ë–µ–ª—å–≥–∏—è', 'PT': '–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è', 'GR': '–ì—Ä–µ—Ü–∏—è',
    'CZ': '–ß–µ—Ö–∏—è', 'HU': '–í–µ–Ω–≥—Ä–∏—è', 'RO': '–†—É–º—ã–Ω–∏—è', 'BG': '–ë–æ–ª–≥–∞—Ä–∏—è',
    'RS': '–°–µ—Ä–±–∏—è', 'HR': '–•–æ—Ä–≤–∞—Ç–∏—è', 'SK': '–°–ª–æ–≤–∞–∫–∏—è', 'SI': '–°–ª–æ–≤–µ–Ω–∏—è',
    'LT': '–õ–∏—Ç–≤–∞', 'LV': '–õ–∞—Ç–≤–∏—è', 'EE': '–≠—Å—Ç–æ–Ω–∏—è', 'AR': '–ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞',
    'CO': '–ö–æ–ª—É–º–±–∏—è', 'CL': '–ß–∏–ª–∏', 'PE': '–ü–µ—Ä—É', 'VE': '–í–µ–Ω–µ—Å—É—ç–ª–∞',
    'PK': '–ü–∞–∫–∏—Å—Ç–∞–Ω', 'BD': '–ë–∞–Ω–≥–ª–∞–¥–µ—à', 'PH': '–§–∏–ª–∏–ø–ø–∏–Ω—ã', 'VN': '–í—å–µ—Ç–Ω–∞–º',
    'TH': '–¢–∞–∏–ª–∞–Ω–¥', 'MY': '–ú–∞–ª–∞–π–∑–∏—è', 'SG': '–°–∏–Ω–≥–∞–ø—É—Ä', 'NZ': '–ù–æ–≤–∞—è –ó–µ–ª–∞–Ω–¥–∏—è',
    'IE': '–ò—Ä–ª–∞–Ω–¥–∏—è', 'IR': '–ò—Ä–∞–Ω',
}

# –ü–æ–ª–Ω–∞—è –±–∞–∑–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤ –†–æ—Å—Å–∏–∏ (–ø–æ –∫–æ–¥–∞–º –≥–æ—Ä–æ–¥–æ–≤)
RUSSIAN_REGIONS = {
    # –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥
    '495': '–ú–æ—Å–∫–≤–∞', '499': '–ú–æ—Å–∫–≤–∞', '498': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '496': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '471': '–ö—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '474': '–õ–∏–ø–µ—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '475': '–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '481': '–°–º–æ–ª–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '482': '–¢–≤–µ—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '483': '–ë—Ä—è–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '484': '–ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '485': '–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '486': '–û—Ä–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '487': '–¢—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '491': '–†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '492': '–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '493': '–ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '494': '–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    
    # –°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥
    '811': '–ü—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '812': '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '813': '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '814': '–ö–∞—Ä–µ–ª–∏—è', '815': '–ú—É—Ä–º–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '816': '–ù–æ–≤–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '817': '–í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '818': '–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '821': '–ö–æ–º–∏',
    '831': '–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '833': '–ö–∏—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '834': '–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    
    # –Æ–∂–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥
    '861': '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π', '862': '–°–æ—á–∏', '863': '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '865': '–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π', '866': '–ö–∞–±–∞—Ä–¥–∏–Ω–æ-–ë–∞–ª–∫–∞—Ä–∏—è', '867': '–°–µ–≤–µ—Ä–Ω–∞—è –û—Å–µ—Ç–∏—è',
    '871': '–ß–µ—á–Ω—è', '872': '–î–∞–≥–µ—Å—Ç–∞–Ω', '873': '–ò–Ω–≥—É—à–µ—Ç–∏—è', '877': '–ê–¥—ã–≥–µ—è',
    '878': '–ö–∞—Ä–∞—á–∞–µ–≤–æ-–ß–µ—Ä–∫–µ—Å–∏—è',
    
    # –ü—Ä–∏–≤–æ–ª–∂—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥
    '835': '–ß—É–≤–∞—à–∏—è', '836': '–ú–∞—Ä–∏–π –≠–ª', '841': '–£–ª—å—è–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '842': '–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '843': '–¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω', '844': '–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '845': '–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '846': '–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '847': '–ö–∞–ª–º—ã–∫–∏—è',
    '848': '–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '851': '–ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    
    # –£—Ä–∞–ª—å—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥
    '343': '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '345': '–¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '346': '–•–∞–Ω—Ç—ã-–ú–∞–Ω—Å–∏–π—Å–∫–∏–π –ê–û',
    '347': '–ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω', '349': '–Ø–º–∞–ª–æ-–ù–µ–Ω–µ—Ü–∫–∏–π –ê–û', '351': '–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '352': '–ö—É—Ä–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    
    # –°–∏–±–∏—Ä—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥
    '381': '–û–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '382': '–¢–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '383': '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '384': '–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '385': '–ê–ª—Ç–∞–π—Å–∫–∏–π –∫—Ä–∞–π', '388': '–•–∞–∫–∞—Å–∏—è',
    '390': '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π', '391': '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π', '394': '–¢—ã–≤–∞',
    '395': '–ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '401': '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    
    # –î–∞–ª—å–Ω–µ–≤–æ—Å—Ç–æ—á–Ω—ã–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥
    '411': '–Ø–∫—É—Ç–∏—è', '413': '–ú–∞–≥–∞–¥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '415': '–ö–∞–º—á–∞—Ç—Å–∫–∏–π –∫—Ä–∞–π',
    '416': '–ê–º—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '421': '–•–∞–±–∞—Ä–æ–≤—Å–∫–∏–π –∫—Ä–∞–π', '423': '–ü—Ä–∏–º–æ—Ä—Å–∫–∏–π –∫—Ä–∞–π',
    '424': '–°–∞—Ö–∞–ª–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '426': '–ï–≤—Ä–µ–π—Å–∫–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –æ–±–ª–∞—Å—Ç—å',
    
    # –ö—Ä—ã–º—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥
    '365': '–ö—Ä—ã–º', '869': '–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å',
}

# --- –£–¢–ò–õ–ò–¢–´ ---
def is_admin(user_id):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    return user_id in ADMIN_IDS

def get_user_balance(user_id):
    """–ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    c.execute("SELECT balance FROM users WHERE user_id = ?", (user_id,))
    result = c.fetchone()
    conn.close()
    return result[0] if result else 0

def update_balance(user_id, amount, transaction_type="system", description=""):
    """–û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    
    try:
        c.execute("SELECT balance FROM users WHERE user_id = ?", (user_id,))
        if not c.fetchone():
            logger.error(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return False
        
        c.execute("UPDATE users SET balance = balance + ? WHERE user_id = ?", (amount, user_id))
        
        c.execute("""INSERT INTO transactions (user_id, amount, type, description) 
                     VALUES (?, ?, ?, ?)""", 
                  (user_id, amount, transaction_type, description))
        
        conn.commit()
        return True
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: {e}")
        conn.rollback()
        return False
    finally:
        conn.close()

def get_user_stats(user_id):
    """–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    
    c.execute("""SELECT username, first_name, last_name, is_premium, premium_expiry, 
                        balance, total_requests, join_date, referred_by
                 FROM users WHERE user_id = ?""", (user_id,))
    user = c.fetchone()
    
    if not user:
        conn.close()
        return None
    
    # –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
    c.execute("SELECT COUNT(*) FROM referrals WHERE referrer_id = ?", (user_id,))
    referrals_count = c.fetchone()[0]
    
    # –ü–æ–ª—É—á–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    c.execute("SELECT COUNT(*) FROM transactions WHERE user_id = ?", (user_id,))
    transactions_count = c.fetchone()[0]
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã
    today = datetime.now().strftime("%Y-%m-%d")
    c.execute("SELECT COUNT(*) FROM requests WHERE user_id = ? AND DATE(timestamp) = ?", 
              (user_id, today))
    today_requests = c.fetchone()[0]
    
    conn.close()
    
    return {
        'username': user[0],
        'first_name': user[1],
        'last_name': user[2],
        'is_premium': user[3],
        'premium_expiry': user[4],
        'balance': user[5],
        'total_requests': user[6],
        'join_date': user[7],
        'referred_by': user[8],
        'referrals_count': referrals_count,
        'transactions_count': transactions_count,
        'today_requests': today_requests
    }

def check_subscription(user_id):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª"""
    if not SUBSCRIPTION_REQUIRED:
        return True
    
    try:
        chat_member = bot.get_chat_member(CHANNEL_USERNAME, user_id)
        return chat_member.status in ['member', 'administrator', 'creator']
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏: {e}")
        return True

def get_phone_info(phone_number):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–æ–º–µ—Ä–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞"""
    try:
        phone_number = phone_number.replace(' ', '').replace('-', '').replace('(', '').replace(')', '')
        
        if phone_number.startswith('8') and len(phone_number) == 11:
            phone_number = '+7' + phone_number[1:]
        elif phone_number.startswith('7') and len(phone_number) == 11:
            phone_number = '+7' + phone_number[1:]
        
        if not phone_number.startswith('+'):
            if phone_number.startswith('8') and len(phone_number) == 11:
                phone_number = '+7' + phone_number[1:]
            elif len(phone_number) == 10:
                phone_number = '+7' + phone_number
            else:
                phone_number = '+' + phone_number
        
        parsed_num = phonenumbers.parse(phone_number, None)
        
        if not phonenumbers.is_valid_number(parsed_num):
            return None
        
        country_code = str(parsed_num.country_code)
        national_number = str(parsed_num.national_number)
        international = phonenumbers.format_number(parsed_num, phonenumbers.PhoneNumberFormat.INTERNATIONAL)
        
        region_code = phonenumbers.region_code_for_number(parsed_num)
        country = COUNTRY_NAMES.get(region_code, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ") if region_code else "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
        
        operator = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
        
        if country_code == '7':
            if region_code == 'KZ':
                for op, prefixes in WORLD_OPERATORS.get('7-KZ', {}).items():
                    for prefix in prefixes:
                        if national_number.startswith(prefix):
                            operator = op
                            break
                    if operator != "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ":
                        break
            else:
                for op, prefixes in WORLD_OPERATORS.get('7', {}).items():
                    for prefix in prefixes:
                        if national_number.startswith(prefix):
                            operator = op
                            break
                    if operator != "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ":
                        break
        
        elif country_code == '1':
            if region_code == 'CA':
                for op, prefixes in WORLD_OPERATORS.get('1-CA', {}).items():
                    for prefix in prefixes:
                        if national_number.startswith(prefix):
                            operator = op
                            break
                    if operator != "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ":
                        break
            else:
                for op, prefixes in WORLD_OPERATORS.get('1', {}).items():
                    for prefix in prefixes:
                        if national_number.startswith(prefix):
                            operator = op
                            break
                    if operator != "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ":
                        break
        
        else:
            if country_code in WORLD_OPERATORS:
                for op, prefixes in WORLD_OPERATORS[country_code].items():
                    for prefix in prefixes:
                        if national_number.startswith(prefix):
                            operator = op
                            break
                    if operator != "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ":
                        break
        
        time_zones = timezone.time_zones_for_number(parsed_num) or ["–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"]
        
        number_type = phonenumbers.number_type(parsed_num)
        type_names = {
            0: "üìû –°—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π",
            1: "üì± –ú–æ–±–∏–ª—å–Ω—ã–π", 
            2: "üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π",
            3: "üíé –ü—Ä–µ–º–∏—É–º",
            5: "üåê VoIP",
            6: "üë§ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π",
            7: "üìü –ü–µ–π–¥–∂–µ—Ä"
        }
        phone_type = type_names.get(number_type, "‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π")
        
        region = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"
        if country_code == '7' and region_code == 'RU':
            if len(national_number) >= 4:
                prefix = national_number[:4]
                if prefix in RUSSIAN_REGIONS:
                    region = RUSSIAN_REGIONS[prefix]
                else:
                    prefix = national_number[:3]
                    region = RUSSIAN_REGIONS.get(prefix, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–≥–∏–æ–Ω")
        
        return {
            "valid": True,
            "international": international,
            "national": phonenumbers.format_number(parsed_num, phonenumbers.PhoneNumberFormat.NATIONAL),
            "country": country,
            "country_code": country_code,
            "operator": operator,
            "region": region,
            "timezones": ", ".join(time_zones),
            "type": phone_type,
            "raw_number": national_number,
            "region_code": region_code
        }
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–º–µ—Ä–∞ {phone_number}: {e}")
        return None

def check_email(email):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ email –∞–¥—Ä–µ—Å–∞ (–±–µ–∑ DNS –ø—Ä–æ–≤–µ—Ä–∫–∏)"""
    try:
        # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ email
        valid = validate_email(email, check_deliverability=False)
        email_info = {
            "valid": True,
            "normalized": valid.normalized,
            "domain": valid.domain,
            "username": valid.username,
            "has_mx": "–ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å"  # –£–±—Ä–∞–Ω–∞ DNS –ø—Ä–æ–≤–µ—Ä–∫–∞
        }
        
        # –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å whois –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
        try:
            domain_info = whois.whois(email_info['domain'])
            email_info['domain_created'] = domain_info.creation_date
            email_info['domain_expires'] = domain_info.expiration_date
            email_info['registrar'] = domain_info.registrar
        except:
            email_info['domain_created'] = None
            email_info['domain_expires'] = None
            email_info['registrar'] = None
        
        return email_info
    except EmailNotValidError:
        return {"valid": False, "error": "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email"}
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ email {email}: {e}")
        return {"valid": False, "error": f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: {str(e)}"}

def generate_qr_code(text):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR –∫–æ–¥–∞"""
    try:
        qr = qrcode.QRCode(
            version=1,
            error_correction=qrcode.constants.ERROR_CORRECT_L,
            box_size=10,
            border=4,
        )
        qr.add_data(text)
        qr.make(fit=True)
        
        img = qr.make_image(fill_color="black", back_color="white")
        
        # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –±–∞–π—Ç—ã
        img_byte_arr = io.BytesIO()
        img.save(img_byte_arr, format='PNG')
        img_byte_arr.seek(0)
        
        return img_byte_arr
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR –∫–æ–¥–∞: {e}")
        return None

def hash_text(text, algorithm='md5'):
    """–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞"""
    try:
        if algorithm == 'md5':
            return hashlib.md5(text.encode()).hexdigest()
        elif algorithm == 'sha1':
            return hashlib.sha1(text.encode()).hexdigest()
        elif algorithm == 'sha256':
            return hashlib.sha256(text.encode()).hexdigest()
        elif algorithm == 'sha512':
            return hashlib.sha512(text.encode()).hexdigest()
        else:
            return None
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")
        return None

def check_password_strength(password):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è"""
    score = 0
    feedback = []
    
    # –î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è
    if len(password) >= 12:
        score += 2
        feedback.append("‚úÖ –î–ª–∏–Ω–∞ –æ—Ç 12 —Å–∏–º–≤–æ–ª–æ–≤")
    elif len(password) >= 8:
        score += 1
        feedback.append("‚ö†Ô∏è –î–ª–∏–Ω–∞ –æ—Ç 8 —Å–∏–º–≤–æ–ª–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 12+)")
    else:
        feedback.append("‚ùå –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤)")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ü–∏—Ñ—Ä
    if re.search(r'\d', password):
        score += 1
        feedback.append("‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç —Ü–∏—Ñ—Ä—ã")
    else:
        feedback.append("‚ùå –ù–µ—Ç —Ü–∏—Ñ—Ä")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –±—É–∫–≤ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
    if re.search(r'[a-z]', password):
        score += 1
        feedback.append("‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã")
    else:
        feedback.append("‚ùå –ù–µ—Ç —Å—Ç—Ä–æ—á–Ω—ã—Ö –±—É–∫–≤")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –±—É–∫–≤ –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
    if re.search(r'[A-Z]', password):
        score += 1
        feedback.append("‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã")
    else:
        feedback.append("‚ùå –ù–µ—Ç –∑–∞–≥–ª–∞–≤–Ω—ã—Ö –±—É–∫–≤")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
    if re.search(r'[!@#$%^&*(),.?":{}|<>]', password):
        score += 1
        feedback.append("‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã")
    else:
        feedback.append("‚ùå –ù–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤")
    
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
    if score >= 5:
        strength = "üí™ –û—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π"
    elif score >= 4:
        strength = "üëç –°–∏–ª—å–Ω—ã–π"
    elif score >= 3:
        strength = "‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π"
    else:
        strength = "‚ùå –°–ª–∞–±—ã–π"
    
    return {
        'score': score,
        'max_score': 6,
        'strength': strength,
        'feedback': feedback
    }

# --- –ú–ï–ù–Æ ---
def create_main_menu(user_id):
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    
    balance = get_user_balance(user_id)
    
    buttons = [
        types.KeyboardButton("üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–º–µ—Ä"),
        types.KeyboardButton("üìß –ü—Ä–æ–≤–µ—Ä–∏—Ç—å email"),
        types.KeyboardButton(f"üí∞ –ë–∞–ª–∞–Ω—Å: {balance}"),
        types.KeyboardButton("üéÅ –ë–æ–Ω—É—Å—ã"),
        types.KeyboardButton("üíé –ü—Ä–µ–º–∏—É–º"),
        types.KeyboardButton("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"),
        types.KeyboardButton("üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã"),
        types.KeyboardButton("‚ÑπÔ∏è –ü–æ–º–æ—â—å")
    ]
    
    if is_admin(user_id):
        buttons.append(types.KeyboardButton("üëë –ê–¥–º–∏–Ω"))
    
    markup.add(*buttons)
    return markup

def create_bonus_menu():
    """–ú–µ–Ω—é –±–æ–Ω—É—Å–æ–≤"""
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    markup.add(
        types.KeyboardButton("üé∞ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å"),
        types.KeyboardButton("üé´ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥"),
        types.KeyboardButton("üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞"),
        types.KeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥")
    )
    return markup

def create_premium_menu():
    """–ú–µ–Ω—é –ø—Ä–µ–º–∏—É–º–∞"""
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    markup.add(
        types.KeyboardButton("üíé 1 –¥–µ–Ω—å - 100 –∫–æ–∏–Ω–æ–≤"),
        types.KeyboardButton("üíé 7 –¥–Ω–µ–π - 500 –∫–æ–∏–Ω–æ–≤"),
        types.KeyboardButton("üíé 30 –¥–Ω–µ–π - 1500 –∫–æ–∏–Ω–æ–≤"),
        types.KeyboardButton("üìã –ú–æ—è –ø–æ–¥–ø–∏—Å–∫–∞"),
        types.KeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥")
    )
    return markup

def create_admin_menu():
    """–ê–¥–º–∏–Ω –º–µ–Ω—é"""
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    markup.add(
        types.KeyboardButton("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞"),
        types.KeyboardButton("üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"),
        types.KeyboardButton("üí∞ –í—ã–¥–∞—Ç—å –∫–æ–∏–Ω—ã"),
        types.KeyboardButton("üé´ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥"),
        types.KeyboardButton("üìã –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤"),
        types.KeyboardButton("üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å"),
        types.KeyboardButton("üéÅ –í—ã–¥–∞—Ç—å –ø—Ä–µ–º–∏—É–º"),
        types.KeyboardButton("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"),
        types.KeyboardButton("‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
    )
    return markup

def create_tools_menu():
    """–ú–µ–Ω—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤"""
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    markup.add(
        types.KeyboardButton("üì± QR –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä"),
        types.KeyboardButton("üîê –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ"),
        types.KeyboardButton("üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è"),
        types.KeyboardButton("üìÑ Base64 –∫–æ–¥–∏—Ä–æ–≤–∫–∞"),
        types.KeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥")
    )
    return markup

def create_hash_menu():
    """–ú–µ–Ω—é —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è"""
    markup = types.InlineKeyboardMarkup(row_width=2)
    markup.add(
        types.InlineKeyboardButton("MD5", callback_data="hash_md5"),
        types.InlineKeyboardButton("SHA-1", callback_data="hash_sha1"),
        types.InlineKeyboardButton("SHA-256", callback_data="hash_sha256"),
        types.InlineKeyboardButton("SHA-512", callback_data="hash_sha512")
    )
    return markup

def create_back_button():
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add(types.KeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥"))
    return markup

# --- –û–°–ù–û–í–ù–´–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ---
@bot.message_handler(commands=['start'])
def start_command(message):
    """–ö–æ–º–∞–Ω–¥–∞ /start"""
    user_id = message.from_user.id
    init_db()
    
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    
    c.execute("SELECT * FROM users WHERE user_id = ?", (user_id,))
    if not c.fetchone():
        referral_code = str(uuid.uuid4())[:8].upper()
        
        referred_by = None
        if len(message.text.split()) > 1:
            ref_code = message.text.split()[1]
            c.execute("SELECT user_id FROM users WHERE referral_code = ?", (ref_code,))
            ref_result = c.fetchone()
            if ref_result:
                referred_by = ref_result[0]
        
        c.execute("""INSERT INTO users 
                     (user_id, username, first_name, last_name, referral_code, referred_by, balance) 
                     VALUES (?, ?, ?, ?, ?, ?, 100)""",
                  (user_id, 
                   message.from_user.username,
                   message.from_user.first_name,
                   message.from_user.last_name,
                   referral_code,
                   referred_by,
                   100))  # –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
        
        if referred_by:
            update_balance(referred_by, REFERRAL_BONUS, "referral", f"–†–µ—Ñ–µ—Ä–∞–ª: {user_id}")
            c.execute("INSERT INTO referrals (referrer_id, referred_id) VALUES (?, ?)",
                     (referred_by, user_id))
        
        conn.commit()
    
    conn.close()
    
    if not check_subscription(user_id):
        markup = types.InlineKeyboardMarkup()
        subscribe_btn = types.InlineKeyboardButton("üì¢ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è", url=CHANNEL_LINK)
        check_btn = types.InlineKeyboardButton("‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å", callback_data="check_subscription")
        markup.add(subscribe_btn, check_btn)
        
        bot.send_message(
            message.chat.id,
            f"üì¢ *–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª*\n\n"
            f"–ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å'",
            reply_markup=markup,
            parse_mode="Markdown"
        )
        return
    
    welcome_text = (
        f"üëã –ü—Ä–∏–≤–µ—Ç, *{message.from_user.first_name}*!\n\n"
        f"üïµÔ∏è‚Äç‚ôÇÔ∏è *OSINT Master Bot*\n\n"
        f"*–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:*\n"
        f"‚Ä¢ üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ—Ä–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤\n"
        f"‚Ä¢ üìß –ê–Ω–∞–ª–∏–∑ email –∞–¥—Ä–µ—Å–æ–≤\n"
        f"‚Ä¢ üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã\n"
        f"‚Ä¢ üí∞ –°–∏—Å—Ç–µ–º–∞ –∫–æ–∏–Ω–æ–≤\n"
        f"‚Ä¢ üéÅ –ë–æ–Ω—É—Å—ã –∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã\n\n"
        f"üí∞ *–í–∞—à –±–∞–ª–∞–Ω—Å:* {get_user_balance(user_id)} {CURRENCY_NAME}\n\n"
        f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ:"
    )
    
    bot.send_message(
        message.chat.id,
        welcome_text,
        reply_markup=create_main_menu(user_id),
        parse_mode="Markdown"
    )

# --- –ë–û–ù–£–°–´ –ò –ü–†–û–ú–û–ö–û–î–´ ---
@bot.message_handler(func=lambda msg: msg.text == "üéÅ –ë–æ–Ω—É—Å—ã")
def bonuses_menu(message):
    bot.send_message(
        message.chat.id,
        "üéÅ *–°–∏—Å—Ç–µ–º–∞ –±–æ–Ω—É—Å–æ–≤*\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=create_bonus_menu(),
        parse_mode="Markdown"
    )

@bot.message_handler(func=lambda msg: msg.text == "üé∞ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å")
def daily_bonus(message):
    """–í—ã–¥–∞—á–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞"""
    user_id = message.from_user.id
    today = datetime.now().strftime("%Y-%m-%d")
    
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ª—É—á–∞–ª –ª–∏ —É–∂–µ –±–æ–Ω—É—Å —Å–µ–≥–æ–¥–Ω—è
    c.execute("SELECT daily_bonus_claimed FROM users WHERE user_id = ?", (user_id,))
    result = c.fetchone()
    
    if result and result[0] == today:
        bot.send_message(
            message.chat.id,
            "‚ùå –í—ã —É–∂–µ –ø–æ–ª—É—á–∞–ª–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å —Å–µ–≥–æ–¥–Ω—è!\n\n"
            "üîÑ –ü—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞–≤—Ç—Ä–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –±–æ–Ω—É—Å–∞.",
            reply_markup=create_bonus_menu()
        )
        conn.close()
        return
    
    # –í—ã–¥–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –±–æ–Ω—É—Å (10-50 –∫–æ–∏–Ω–æ–≤)
    bonus_amount = random.randint(10, 50)
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞—Ç—É –ø–æ–ª—É—á–µ–Ω–∏—è
    c.execute("UPDATE users SET balance = balance + ?, daily_bonus_claimed = ? WHERE user_id = ?",
              (bonus_amount, today, user_id))
    
    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    c.execute("INSERT INTO transactions (user_id, amount, type, description) VALUES (?, ?, ?, ?)",
              (user_id, bonus_amount, "daily_bonus", "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å"))
    
    conn.commit()
    
    # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å
    c.execute("SELECT balance FROM users WHERE user_id = ?", (user_id,))
    new_balance = c.fetchone()[0]
    
    conn.close()
    
    bot.send_message(
        message.chat.id,
        f"üéâ *–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å –ø–æ–ª—É—á–µ–Ω!*\n\n"
        f"üí∞ *–ü–æ–ª—É—á–µ–Ω–æ:* {bonus_amount} {CURRENCY_NAME}\n"
        f"üí≥ *–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:* {new_balance} {CURRENCY_NAME}\n\n"
        f"üîÑ –°–ª–µ–¥—É—é—â–∏–π –±–æ–Ω—É—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∑–∞–≤—Ç—Ä–∞!",
        parse_mode="Markdown",
        reply_markup=create_bonus_menu()
    )

@bot.message_handler(func=lambda msg: msg.text == "üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞")
def referral_system(message):
    """–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞"""
    user_id = message.from_user.id
    
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    
    # –ü–æ–ª—É—á–∞–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    c.execute("SELECT referral_code FROM users WHERE user_id = ?", (user_id,))
    referral_code = c.fetchone()[0]
    
    # –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
    c.execute("SELECT COUNT(*) FROM referrals WHERE referrer_id = ?", (user_id,))
    referrals_count = c.fetchone()[0]
    
    # –ü–æ–ª—É—á–∞–µ–º –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã
    c.execute("SELECT SUM(amount) FROM transactions WHERE user_id = ? AND type = 'referral'", (user_id,))
    total_bonus = c.fetchone()[0] or 0
    
    conn.close()
    
    referral_link = f"https://t.me/{bot.get_me().username}?start={referral_code}"
    
    response = (
        f"üë• *–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞*\n\n"
        f"üìä *–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:*\n"
        f"‚Ä¢ üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {referrals_count}\n"
        f"‚Ä¢ üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –±–æ–Ω—É—Å–æ–≤: {total_bonus} {CURRENCY_NAME}\n\n"
        f"üéÅ *–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:*\n"
        f"1. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–µ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π\n"
        f"2. –ó–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ –¥—Ä—É–≥–∞ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ {REFERRAL_BONUS} {CURRENCY_NAME}\n"
        f"3. –í–∞—à –¥—Ä—É–≥ –ø–æ–ª—É—á–∞–µ—Ç 100 {CURRENCY_NAME} –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏\n\n"
        f"üîó *–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:*\n"
        f"`{referral_link}`\n\n"
        f"üìù *–í–∞—à —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥:*\n"
        f"`{referral_code}`"
    )
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=create_bonus_menu()
    )

@bot.message_handler(func=lambda msg: msg.text == "üé´ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥")
def activate_promo_start(message):
    """–ù–∞—á–∞–ª–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞"""
    msg = bot.send_message(
        message.chat.id,
        "üé´ *–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞*\n\n"
        "–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:",
        reply_markup=create_back_button(),
        parse_mode="Markdown"
    )
    bot.register_next_step_handler(msg, activate_promo_process)

def activate_promo_process(message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞"""
    if message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥":
        bot.send_message(message.chat.id, "–ú–µ–Ω—é –±–æ–Ω—É—Å–æ–≤:", reply_markup=create_bonus_menu())
        return
    
    user_id = message.from_user.id
    promo_code = message.text.strip().upper()
    
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    
    try:
        # –ò—â–µ–º –ø—Ä–æ–º–æ–∫–æ–¥
        c.execute("""SELECT id, amount, uses_left, expiry_date, is_active 
                     FROM promocodes WHERE code = ?""", (promo_code,))
        promo = c.fetchone()
        
        if not promo:
            bot.send_message(
                message.chat.id,
                "‚ùå *–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω!*\n\n"
                "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞ –∏–ª–∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞.",
                parse_mode="Markdown",
                reply_markup=create_bonus_menu()
            )
            conn.close()
            return
        
        promo_id, amount, uses_left, expiry_date, is_active = promo
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        if is_active == 0:
            bot.send_message(message.chat.id, "‚ùå –ü—Ä–æ–º–æ–∫–æ–¥ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!", reply_markup=create_bonus_menu())
            conn.close()
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
        if expiry_date:
            expiry = datetime.strptime(expiry_date, "%Y-%m-%d %H:%M:%S")
            if expiry < datetime.now():
                bot.send_message(message.chat.id, "‚ùå –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞ –∏—Å—Ç–µ–∫!", reply_markup=create_bonus_menu())
                conn.close()
                return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
        if uses_left <= 0:
            bot.send_message(message.chat.id, "‚ùå –ü—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑!", reply_markup=create_bonus_menu())
            conn.close()
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —ç—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥
        c.execute("SELECT * FROM promocode_usage WHERE user_id = ? AND promocode_id = ?", (user_id, promo_id))
        if c.fetchone():
            bot.send_message(message.chat.id, "‚ùå –í—ã —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ —ç—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥!", reply_markup=create_bonus_menu())
            conn.close()
            return
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        update_balance(user_id, amount, "promocode", f"–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞: {promo_code}")
        
        # –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
        c.execute("UPDATE promocodes SET uses_left = uses_left - 1 WHERE id = ?", (promo_id,))
        
        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
        c.execute("INSERT INTO promocode_usage (user_id, promocode_id) VALUES (?, ?)", (user_id, promo_id))
        
        conn.commit()
        
        # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å
        new_balance = get_user_balance(user_id)
        
        bot.send_message(
            message.chat.id,
            f"‚úÖ *–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ!*\n\n"
            f"üé´ *–ü—Ä–æ–º–æ–∫–æ–¥:* {promo_code}\n"
            f"üí∞ *–ü–æ–ª—É—á–µ–Ω–æ:* {amount} {CURRENCY_NAME}\n"
            f"üí≥ *–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:* {new_balance} {CURRENCY_NAME}",
            parse_mode="Markdown",
            reply_markup=create_bonus_menu()
        )
        
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞: {e}")
        bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞: {str(e)}", reply_markup=create_bonus_menu())
    finally:
        conn.close()

# --- –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ---
@bot.message_handler(func=lambda msg: msg.text == "üëë –ê–¥–º–∏–Ω" and is_admin(msg.from_user.id))
def admin_panel(message):
    bot.send_message(
        message.chat.id,
        "üëë *–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å*\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=create_admin_menu(),
        parse_mode="Markdown"
    )

@bot.message_handler(func=lambda msg: msg.text == "üí∞ –í—ã–¥–∞—Ç—å –∫–æ–∏–Ω—ã" and is_admin(msg.from_user.id))
def give_coins_start(message):
    msg = bot.send_message(
        message.chat.id,
        "üí∞ *–í—ã–¥–∞—á–∞ –∫–æ–∏–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é*\n\n"
        "–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª:\n"
        "–ü—Ä–∏–º–µ—Ä: `123456789 500`",
        reply_markup=create_back_button(),
        parse_mode="Markdown"
    )
    bot.register_next_step_handler(msg, give_coins_process)

def give_coins_process(message):
    if message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥":
        bot.send_message(message.chat.id, "–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:", reply_markup=create_admin_menu())
        return
    
    try:
        parts = message.text.split()
        if len(parts) != 2:
            bot.send_message(message.chat.id, "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ID –ö–û–õ–ò–ß–ï–°–¢–í–û")
            return
        
        user_id = int(parts[0])
        amount = int(parts[1])
        
        if amount <= 0:
            bot.send_message(message.chat.id, "‚ùå –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–∏–Ω–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º")
            return
        
        conn = sqlite3.connect('osint.db')
        c = conn.cursor()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        c.execute("SELECT username, first_name FROM users WHERE user_id = ?", (user_id,))
        user_info = c.fetchone()
        
        if not user_info:
            bot.send_message(message.chat.id, "‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
            conn.close()
            return
        
        username, first_name = user_info
        
        # –í—ã–¥–∞–µ–º –∫–æ–∏–Ω—ã
        update_balance(user_id, amount, "admin_gift", "–í—ã–¥–∞—á–∞ –∫–æ–∏–Ω–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º")
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        try:
            bot.send_message(
                user_id,
                f"üéÅ *–í–∞–º –≤—ã–¥–∞–Ω—ã –∫–æ–∏–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!*\n\n"
                f"üí∞ *–ü–æ–ª—É—á–µ–Ω–æ:* {amount} {CURRENCY_NAME}\n"
                f"üí≥ *–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:* {get_user_balance(user_id)} {CURRENCY_NAME}",
                parse_mode="Markdown"
            )
        except:
            pass
        
        bot.send_message(
            message.chat.id,
            f"‚úÖ *–ö–æ–∏–Ω—ã —É—Å–ø–µ—à–Ω–æ –≤—ã–¥–∞–Ω—ã!*\n\n"
            f"üë§ *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:* {first_name} (@{username})\n"
            f"üÜî *ID:* {user_id}\n"
            f"üí∞ *–í—ã–¥–∞–Ω–æ:* {amount} {CURRENCY_NAME}",
            parse_mode="Markdown",
            reply_markup=create_admin_menu()
        )
        
    except ValueError:
        bot.send_message(message.chat.id, "‚ùå –û—à–∏–±–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–∏–Ω–æ–≤")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤—ã–¥–∞—á–∏ –∫–æ–∏–Ω–æ–≤: {e}")
        bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@bot.message_handler(func=lambda msg: msg.text == "üé´ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥" and is_admin(msg.from_user.id))
def create_promo_start(message):
    msg = bot.send_message(
        message.chat.id,
        "üé´ *–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞*\n\n"
        "–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n"
        "`–ö–û–õ–ò–ß–ï–°–¢–í–û_–ö–û–ò–ù–û–í –ö–û–õ–ò–ß–ï–°–¢–í–û_–ê–ö–¢–ò–í–ê–¶–ò–ô –û–ü–ò–°–ê–ù–ò–ï`\n\n"
        "–ü—Ä–∏–º–µ—Ä: `100 10 –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥`\n\n"
        "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:\n"
        "- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–π: 0 = –±–µ–∑–ª–∏–º–∏—Ç–Ω–æ",
        reply_markup=create_back_button(),
        parse_mode="Markdown"
    )
    bot.register_next_step_handler(msg, create_promo_process)

def create_promo_process(message):
    if message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥":
        bot.send_message(message.chat.id, "–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:", reply_markup=create_admin_menu())
        return
    
    try:
        parts = message.text.split(maxsplit=2)
        if len(parts) < 3:
            bot.send_message(message.chat.id, "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –ö–û–ò–ù–´ –ê–ö–¢–ò–í–ê–¶–ò–ò –û–ü–ò–°–ê–ù–ò–ï")
            return
        
        amount = int(parts[0])
        uses_total = int(parts[1])
        description = parts[2]
        
        if amount <= 0:
            bot.send_message(message.chat.id, "‚ùå –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–∏–Ω–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º")
            return
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–º–æ–∫–æ–¥
        promo_code = ''.join(random.choices(string.ascii_uppercase + string.digits, k=PROMO_CODE_LENGTH))
        
        conn = sqlite3.connect('osint.db')
        c = conn.cursor()
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–º–æ–∫–æ–¥
        c.execute("""INSERT INTO promocodes 
                     (code, amount, uses_total, uses_left, created_by, description) 
                     VALUES (?, ?, ?, ?, ?, ?)""",
                  (promo_code, amount, uses_total, uses_total, message.from_user.id, description))
        
        conn.commit()
        conn.close()
        
        uses_text = "–±–µ–∑–ª–∏–º–∏—Ç–Ω–æ" if uses_total == 0 else f"{uses_total} –∞–∫—Ç–∏–≤–∞—Ü–∏–π"
        
        bot.send_message(
            message.chat.id,
            f"‚úÖ *–ü—Ä–æ–º–æ–∫–æ–¥ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!*\n\n"
            f"üé´ *–ö–æ–¥:* `{promo_code}`\n"
            f"üí∞ *–ö–æ–∏–Ω—ã:* {amount} {CURRENCY_NAME}\n"
            f"üìä *–ê–∫—Ç–∏–≤–∞—Ü–∏–π:* {uses_text}\n"
            f"üìù *–û–ø–∏—Å–∞–Ω–∏–µ:* {description}",
            parse_mode="Markdown",
            reply_markup=create_admin_menu()
        )
        
    except ValueError:
        bot.send_message(message.chat.id, "‚ùå –û—à–∏–±–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞: {e}")
        bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@bot.message_handler(func=lambda msg: msg.text == "üìã –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤" and is_admin(msg.from_user.id))
def list_promocodes(message):
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    
    c.execute("""SELECT code, amount, uses_total, uses_left, expiry_date, is_active, description 
                 FROM promocodes ORDER BY created_date DESC LIMIT 20""")
    promos = c.fetchall()
    conn.close()
    
    if not promos:
        bot.send_message(message.chat.id, "üì≠ –ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤")
        return
    
    response = "üìã *–ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤*\n\n"
    
    for promo in promos:
        code, amount, uses_total, uses_left, expiry_date, is_active, description = promo
        status = "‚úÖ –ê–∫—Ç–∏–≤–µ–Ω" if is_active == 1 else "‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω"
        uses_text = f"{uses_left}/{uses_total}" if uses_total > 0 else "‚àû"
        
        response += f"üé´ *{code}* - {status}\n"
        response += f"üí∞ {amount} –∫–æ–∏–Ω–æ–≤ | üìä {uses_text} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π\n"
        if expiry_date:
            response += f"üìÖ –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: {expiry_date}\n"
        response += f"üìù {description[:50]}{'...' if len(description) > 50 else ''}\n"
        response += f"{'-'*30}\n"
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=create_admin_menu()
    )

@bot.message_handler(func=lambda msg: msg.text == "üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏" and is_admin(msg.from_user.id))
def manage_users(message):
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    
    c.execute("SELECT user_id, username, first_name, balance, is_premium, is_banned FROM users ORDER BY join_date DESC LIMIT 20")
    users = c.fetchall()
    conn.close()
    
    if not users:
        bot.send_message(message.chat.id, "üì≠ –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
        return
    
    response = "üë• *–ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π*\n\n"
    
    for user in users:
        user_id, username, first_name, balance, is_premium, is_banned = user
        premium_status = "üíé" if is_premium == 1 else "üë§"
        ban_status = "üö´" if is_banned == 1 else "‚úÖ"
        response += f"{premium_status}{ban_status} *{first_name or '–ë–µ–∑ –∏–º–µ–Ω–∏'}* (@{username or '–Ω–µ—Ç'})\n"
        response += f"üÜî `{user_id}` | üí∞ {balance} –∫–æ–∏–Ω–æ–≤\n"
        response += f"{'-'*30}\n"
    
    markup = types.InlineKeyboardMarkup()
    markup.add(
        types.InlineKeyboardButton("üìä –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="admin_detailed_stats"),
        types.InlineKeyboardButton("üìà –ì—Ä–∞—Ñ–∏–∫–∏", callback_data="admin_charts")
    )
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=markup
    )

@bot.message_handler(func=lambda msg: msg.text == "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞" and is_admin(msg.from_user.id))
def bot_stats(message):
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    
    # –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    c.execute("SELECT COUNT(*) FROM users")
    total_users = c.fetchone()[0]
    
    c.execute("SELECT COUNT(*) FROM users WHERE is_premium = 1")
    premium_users = c.fetchone()[0]
    
    c.execute("SELECT COUNT(*) FROM users WHERE is_banned = 1")
    banned_users = c.fetchone()[0]
    
    c.execute("SELECT COUNT(*) FROM requests")
    total_requests = c.fetchone()[0]
    
    c.execute("SELECT SUM(balance) FROM users")
    total_coins = c.fetchone()[0] or 0
    
    c.execute("SELECT COUNT(*) FROM promocodes")
    total_promos = c.fetchone()[0]
    
    c.execute("SELECT COUNT(*) FROM referrals")
    total_referrals = c.fetchone()[0]
    
    # –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
    week_ago = (datetime.now() - timedelta(days=7)).strftime("%Y-%m-%d")
    c.execute("SELECT COUNT(DISTINCT user_id) FROM requests WHERE timestamp >= ?", (week_ago,))
    active_users = c.fetchone()[0]
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º
    c.execute("""SELECT DATE(timestamp), COUNT(*) 
                 FROM requests 
                 WHERE timestamp >= DATE('now', '-7 days') 
                 GROUP BY DATE(timestamp) 
                 ORDER BY DATE(timestamp) DESC""")
    daily_stats = c.fetchall()
    
    conn.close()
    
    response = (
        f"üìä *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞*\n\n"
        f"üë• *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:*\n"
        f"‚Ä¢ –í—Å–µ–≥–æ: {total_users}\n"
        f"‚Ä¢ –ü—Ä–µ–º–∏—É–º: {premium_users}\n"
        f"‚Ä¢ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: {banned_users}\n"
        f"‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ –Ω–µ–¥–µ–ª—é: {active_users}\n\n"
        f"üìà *–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:*\n"
        f"‚Ä¢ –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: {total_requests}\n"
        f"‚Ä¢ –í—Å–µ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤: {total_referrals}\n"
        f"‚Ä¢ –ü—Ä–æ–º–æ–∫–æ–¥–æ–≤: {total_promos}\n"
        f"‚Ä¢ –ö–æ–∏–Ω–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ: {total_coins}\n\n"
        f"üìÖ *–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ 7 –¥–Ω–µ–π:*\n"
    )
    
    for date_str, count in daily_stats[:7]:  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
        response += f"‚Ä¢ {date_str}: {count} –∑–∞–ø—Ä–æ—Å–æ–≤\n"
    
    response += f"\nüîÑ *–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:* {datetime.now().strftime('%d.%m.%Y %H:%M')}"
    
    markup = types.InlineKeyboardMarkup()
    markup.add(
        types.InlineKeyboardButton("üîÑ –û–±–Ω–æ–≤–∏—Ç—å", callback_data="refresh_stats"),
        types.InlineKeyboardButton("üì§ –≠–∫—Å–ø–æ—Ä—Ç", callback_data="export_stats")
    )
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=markup
    )

@bot.message_handler(func=lambda msg: msg.text == "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏" and is_admin(msg.from_user.id))
def admin_settings(message):
    response = (
        f"‚öôÔ∏è *–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞*\n\n"
        f"üìä *–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:*\n"
        f"‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–º–µ—Ä–∞: {PHONE_CHECK_PRICE} {CURRENCY_NAME}\n"
        f"‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ email: {EMAIL_CHECK_PRICE} {CURRENCY_NAME}\n"
        f"‚Ä¢ –ë–æ–Ω—É—Å –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞: {REFERRAL_BONUS} {CURRENCY_NAME}\n"
        f"‚Ä¢ –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: 100 {CURRENCY_NAME}\n"
        f"‚Ä¢ –ü—Ä–µ–º–∏—É–º 1 –¥–µ–Ω—å: {PREMIUM_COST_1DAY} {CURRENCY_NAME}\n"
        f"‚Ä¢ –ü—Ä–µ–º–∏—É–º 7 –¥–Ω–µ–π: {PREMIUM_COST_7DAY} {CURRENCY_NAME}\n"
        f"‚Ä¢ –ü—Ä–µ–º–∏—É–º 30 –¥–Ω–µ–π: {PREMIUM_COST_30DAY} {CURRENCY_NAME}\n\n"
        f"üì¢ *–ö–∞–Ω–∞–ª:* {CHANNEL_USERNAME}\n"
        f"üîê *–ê–¥–º–∏–Ω—ã:* {len(ADMIN_IDS)} —á–µ–ª–æ–≤–µ–∫\n\n"
        f"*–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –∫–æ–¥–µ –±–æ—Ç–∞.*"
    )
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=create_admin_menu()
    )

@bot.message_handler(func=lambda msg: msg.text == "üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" and is_admin(msg.from_user.id))
def ban_user_start(message):
    msg = bot.send_message(
        message.chat.id,
        "üö´ *–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è*\n\n"
        "–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:",
        reply_markup=create_back_button(),
        parse_mode="Markdown"
    )
    bot.register_next_step_handler(msg, ban_user_process)

def ban_user_process(message):
    if message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥":
        bot.send_message(message.chat.id, "–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:", reply_markup=create_admin_menu())
        return
    
    try:
        user_id = int(message.text.strip())
        
        conn = sqlite3.connect('osint.db')
        c = conn.cursor()
        
        c.execute("SELECT username, first_name, is_banned FROM users WHERE user_id = ?", (user_id,))
        user_info = c.fetchone()
        
        if not user_info:
            bot.send_message(message.chat.id, "‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
            conn.close()
            return
        
        username, first_name, is_banned = user_info
        
        if is_banned == 1:
            # –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
            c.execute("UPDATE users SET is_banned = 0 WHERE user_id = ?", (user_id,))
            action = "—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω"
            action_emoji = "‚úÖ"
        else:
            # –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
            c.execute("UPDATE users SET is_banned = 1 WHERE user_id = ?", (user_id,))
            action = "–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω"
            action_emoji = "üö´"
        
        conn.commit()
        conn.close()
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        try:
            if is_banned == 1:
                bot.send_message(
                    user_id,
                    f"‚úÖ *–í–∞—à –∞–∫–∫–∞—É–Ω—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!*\n\n"
                    f"–¢–µ–ø–µ—Ä—å –≤—ã —Å–Ω–æ–≤–∞ –º–æ–∂–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º.",
                    parse_mode="Markdown"
                )
            else:
                bot.send_message(
                    user_id,
                    f"üö´ *–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!*\n\n"
                    f"–î–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.",
                    parse_mode="Markdown"
                )
        except:
            pass
        
        bot.send_message(
            message.chat.id,
            f"{action_emoji} *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {action}!*\n\n"
            f"üë§ *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:* {first_name} (@{username})\n"
            f"üÜî *ID:* {user_id}",
            parse_mode="Markdown",
            reply_markup=create_admin_menu()
        )
        
    except ValueError:
        bot.send_message(message.chat.id, "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: {e}")
        bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

@bot.message_handler(func=lambda msg: msg.text == "üéÅ –í—ã–¥–∞—Ç—å –ø—Ä–µ–º–∏—É–º" and is_admin(msg.from_user.id))
def give_premium_start(message):
    msg = bot.send_message(
        message.chat.id,
        "üéÅ *–í—ã–¥–∞—á–∞ –ø—Ä–µ–º–∏—É–º–∞*\n\n"
        "–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª:\n"
        "–ü—Ä–∏–º–µ—Ä: `123456789 30`\n\n"
        "–î–ª—è –æ—Ç–º–µ–Ω—ã –ø—Ä–µ–º–∏—É–º–∞ —É–∫–∞–∂–∏—Ç–µ 0 –¥–Ω–µ–π",
        reply_markup=create_back_button(),
        parse_mode="Markdown"
    )
    bot.register_next_step_handler(msg, give_premium_process)

def give_premium_process(message):
    if message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥":
        bot.send_message(message.chat.id, "–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:", reply_markup=create_admin_menu())
        return
    
    try:
        parts = message.text.split()
        if len(parts) != 2:
            bot.send_message(message.chat.id, "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ID –î–ù–ò")
            return
        
        user_id = int(parts[0])
        days = int(parts[1])
        
        conn = sqlite3.connect('osint.db')
        c = conn.cursor()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        c.execute("SELECT username, first_name FROM users WHERE user_id = ?", (user_id,))
        user_info = c.fetchone()
        
        if not user_info:
            bot.send_message(message.chat.id, "‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
            conn.close()
            return
        
        username, first_name = user_info
        
        if days == 0:
            # –û—Ç–º–µ–Ω–∞ –ø—Ä–µ–º–∏—É–º–∞
            c.execute("UPDATE users SET is_premium = 0, premium_expiry = NULL WHERE user_id = ?", (user_id,))
            action = "–æ—Ç–º–µ–Ω–µ–Ω"
            action_emoji = "‚ùå"
            expiry_text = "—Å–Ω—è—Ç"
        else:
            # –í—ã–¥–∞—á–∞ –ø—Ä–µ–º–∏—É–º–∞
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–¥–ø–∏—Å–∫—É
            c.execute("SELECT premium_expiry FROM users WHERE user_id = ?", (user_id,))
            result = c.fetchone()
            current_expiry = result[0] if result and result[0] else datetime.now()
            
            if isinstance(current_expiry, str):
                current_expiry = datetime.strptime(current_expiry, "%Y-%m-%d %H:%M:%S")
            
            # –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –µ—â–µ –∞–∫—Ç–∏–≤–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º –∫ –Ω–µ–π
            if current_expiry > datetime.now():
                new_expiry = current_expiry + timedelta(days=days)
            else:
                new_expiry = datetime.now() + timedelta(days=days)
            
            # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—Ä–µ–º–∏—É–º
            c.execute("UPDATE users SET is_premium = 1, premium_expiry = ? WHERE user_id = ?",
                      (new_expiry.strftime("%Y-%m-%d %H:%M:%S"), user_id))
            action = "–≤—ã–¥–∞–Ω"
            action_emoji = "‚úÖ"
            expiry_text = f"–¥–æ {new_expiry.strftime('%d.%m.%Y %H:%M')}"
        
        conn.commit()
        conn.close()
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        try:
            if days == 0:
                bot.send_message(
                    user_id,
                    f"‚ùå *–í–∞—à –ø—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å –æ—Ç–º–µ–Ω–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!*",
                    parse_mode="Markdown"
                )
            else:
                bot.send_message(
                    user_id,
                    f"üéâ *–í–∞–º –≤—ã–¥–∞–Ω –ø—Ä–µ–º–∏—É–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!*\n\n"
                    f"üíé *–°—Ä–æ–∫:* {days} –¥–Ω–µ–π\n"
                    f"üìÖ *–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ:* {new_expiry.strftime('%d.%m.%Y %H:%M')}",
                    parse_mode="Markdown"
                )
        except:
            pass
        
        response = f"{action_emoji} *–ü—Ä–µ–º–∏—É–º {action}!*\n\n"
        response += f"üë§ *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:* {first_name} (@{username})\n"
        response += f"üÜî *ID:* {user_id}\n"
        
        if days > 0:
            response += f"üíé *–°—Ä–æ–∫:* {days} –¥–Ω–µ–π\n"
            response += f"üìÖ *–î–µ–π—Å—Ç–≤—É–µ—Ç:* {expiry_text}"
        else:
            response += f"üíé *–°—Ç–∞—Ç—É—Å:* –ü—Ä–µ–º–∏—É–º –æ—Ç–º–µ–Ω–µ–Ω"
        
        bot.send_message(
            message.chat.id,
            response,
            parse_mode="Markdown",
            reply_markup=create_admin_menu()
        )
        
    except ValueError:
        bot.send_message(message.chat.id, "‚ùå –û—à–∏–±–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤—ã–¥–∞—á–∏ –ø—Ä–µ–º–∏—É–º–∞: {e}")
        bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

# --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–õ–Ø –û–°–¢–ê–õ–¨–ù–´–• –§–£–ù–ö–¶–ò–ô ---
@bot.message_handler(func=lambda msg: msg.text == "üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–º–µ—Ä")
def ask_phone_number(message):
    user_id = message.from_user.id
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    c.execute("SELECT is_banned FROM users WHERE user_id = ?", (user_id,))
    result = c.fetchone()
    if result and result[0] == 1:
        bot.send_message(message.chat.id, "üö´ –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!")
        conn.close()
        return
    conn.close()
    
    balance = get_user_balance(user_id)
    if balance < PHONE_CHECK_PRICE:
        bot.send_message(
            message.chat.id,
            f"‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤!\n"
            f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {balance} {CURRENCY_NAME}\n"
            f"üí∏ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏: {PHONE_CHECK_PRICE} {CURRENCY_NAME}\n\n"
            f"üéÅ –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–∏–Ω—ã —á–µ—Ä–µ–∑ –º–µ–Ω—é '–ë–æ–Ω—É—Å—ã'",
            reply_markup=create_main_menu(user_id)
        )
        return
    
    msg = bot.send_message(
        message.chat.id,
        f"üì± *–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:*\n\n"
        f"–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:\n"
        f"‚Ä¢ +79123456789\n" 
        f"‚Ä¢ 89123456789\n"
        f"‚Ä¢ +380441234567\n"
        f"‚Ä¢ +12345678901\n\n"
        f"üí° *–°—Ç–æ–∏–º–æ—Å—Ç—å:* {PHONE_CHECK_PRICE} –∫–æ–∏–Ω–æ–≤",
        reply_markup=create_back_button(),
        parse_mode="Markdown"
    )
    bot.register_next_step_handler(msg, process_phone_number)

def process_phone_number(message):
    if message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥":
        bot.send_message(message.chat.id, "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", reply_markup=create_main_menu(message.from_user.id))
        return
    
    user_id = message.from_user.id
    phone = message.text.strip()
    
    update_balance(user_id, -PHONE_CHECK_PRICE, "phone_check", f"–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ—Ä–∞: {phone}")
    
    bot.send_message(message.chat.id, "üîç –ü—Ä–æ–≤–µ—Ä—è—é –Ω–æ–º–µ—Ä...")
    
    info = get_phone_info(phone)
    
    if not info:
        bot.send_message(
            message.chat.id,
            "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –∏–ª–∏ –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏.",
            reply_markup=create_main_menu(user_id)
        )
        return
    
    response = (
        f"üìä *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–º–µ—Ä–µ:*\n\n"
        f"üì± *–ù–æ–º–µ—Ä:* `{info['international']}`\n"
        f"üìç *–°—Ç—Ä–∞–Ω–∞:* {info['country']}\n"
        f"üè¢ *–û–ø–µ—Ä–∞—Ç–æ—Ä:* {info['operator']}\n"
        f"üó∫Ô∏è *–†–µ–≥–∏–æ–Ω:* {info['region']}\n"
        f"üïí *–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:* {info['timezones']}\n"
        f"üìû *–¢–∏–ø:* {info['type']}\n\n"
        f"üí∞ *–ü–æ—Ç—Ä–∞—á–µ–Ω–æ:* {PHONE_CHECK_PRICE} {CURRENCY_NAME}\n"
        f"üí≥ *–ë–∞–ª–∞–Ω—Å:* {get_user_balance(user_id)} {CURRENCY_NAME}"
    )
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=create_main_menu(user_id)
    )

@bot.message_handler(func=lambda msg: msg.text == "üìß –ü—Ä–æ–≤–µ—Ä–∏—Ç—å email")
def ask_email(message):
    user_id = message.from_user.id
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    c.execute("SELECT is_banned FROM users WHERE user_id = ?", (user_id,))
    result = c.fetchone()
    if result and result[0] == 1:
        bot.send_message(message.chat.id, "üö´ –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!")
        conn.close()
        return
    conn.close()
    
    balance = get_user_balance(user_id)
    if balance < EMAIL_CHECK_PRICE:
        bot.send_message(
            message.chat.id,
            f"‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤!\n"
            f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {balance} {CURRENCY_NAME}\n"
            f"üí∏ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏: {EMAIL_CHECK_PRICE} {CURRENCY_NAME}\n\n"
            f"üéÅ –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–∏–Ω—ã —á–µ—Ä–µ–∑ –º–µ–Ω—é '–ë–æ–Ω—É—Å—ã'",
            reply_markup=create_main_menu(user_id)
        )
        return
    
    msg = bot.send_message(
        message.chat.id,
        f"üìß *–í–≤–µ–¥–∏—Ç–µ email –∞–¥—Ä–µ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:*\n\n"
        f"–ü—Ä–∏–º–µ—Ä: example@gmail.com\n\n"
        f"üí° *–°—Ç–æ–∏–º–æ—Å—Ç—å:* {EMAIL_CHECK_PRICE} –∫–æ–∏–Ω–æ–≤",
        reply_markup=create_back_button(),
        parse_mode="Markdown"
    )
    bot.register_next_step_handler(msg, process_email)

def process_email(message):
    if message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥":
        bot.send_message(message.chat.id, "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", reply_markup=create_main_menu(message.from_user.id))
        return
    
    user_id = message.from_user.id
    email = message.text.strip()
    
    update_balance(user_id, -EMAIL_CHECK_PRICE, "email_check", f"–ü—Ä–æ–≤–µ—Ä–∫–∞ email: {email}")
    
    bot.send_message(message.chat.id, "üîç –ü—Ä–æ–≤–µ—Ä—è—é email...")
    
    email_info = check_email(email)
    
    if not email_info.get('valid', False):
        response = (
            f"‚ùå *–ù–µ–≤–µ—Ä–Ω—ã–π email –∞–¥—Ä–µ—Å*\n\n"
            f"üìß *–í–≤–µ–¥—ë–Ω–Ω—ã–π email:* `{email}`\n\n"
            f"–û—à–∏–±–∫–∞: {email_info.get('error', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')}"
        )
    else:
        response = (
            f"‚úÖ *Email –ø—Ä–æ–≤–µ—Ä–µ–Ω —É—Å–ø–µ—à–Ω–æ*\n\n"
            f"üìß *Email:* `{email_info['normalized']}`\n"
            f"üë§ *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:* `{email_info['username']}`\n"
            f"üåê *–î–æ–º–µ–Ω:* `{email_info['domain']}`\n"
            f"üìÆ *MX –∑–∞–ø–∏—Å–∏:* {email_info.get('has_mx', '–ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å')}\n"
        )
        
        if email_info.get('registrar'):
            response += f"üè¢ *–†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä:* {email_info['registrar']}\n"
        
        if email_info.get('domain_created'):
            created = email_info['domain_created']
            if isinstance(created, list):
                created = created[0]
            response += f"üìÖ *–°–æ–∑–¥–∞–Ω:* {created}\n"
    
    response += f"\nüí∞ *–ü–æ—Ç—Ä–∞—á–µ–Ω–æ:* {EMAIL_CHECK_PRICE} {CURRENCY_NAME}\nüí≥ *–ë–∞–ª–∞–Ω—Å:* {get_user_balance(user_id)} {CURRENCY_NAME}"
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=create_main_menu(user_id)
    )

@bot.message_handler(func=lambda msg: msg.text == "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
def show_stats(message):
    user_id = message.from_user.id
    stats = get_user_stats(user_id)
    
    if not stats:
        bot.send_message(message.chat.id, "‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏")
        return
    
    premium_status = "‚úÖ –ê–∫—Ç–∏–≤–µ–Ω" if stats['is_premium'] == 1 else "‚ùå –ù–µ –∞–∫—Ç–∏–≤–µ–Ω"
    premium_expiry = f"–¥–æ {stats['premium_expiry']}" if stats['premium_expiry'] else "–Ω–µ—Ç"
    
    response = (
        f"üìä *–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞*\n\n"
        f"üë§ *–ò–º—è:* {stats['first_name']} {stats['last_name'] or ''}\n"
        f"üîñ *Username:* @{stats['username'] or '–Ω–µ—Ç'}\n"
        f"üÜî *ID:* `{user_id}`\n\n"
        f"üíé *–ü—Ä–µ–º–∏—É–º:* {premium_status}\n"
        f"üìÖ *–ò—Å—Ç–µ–∫–∞–µ—Ç:* {premium_expiry}\n\n"
        f"üí∞ *–ë–∞–ª–∞–Ω—Å:* {stats['balance']} {CURRENCY_NAME}\n"
        f"üìà *–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤:* {stats['total_requests']}\n"
        f"üìä *–ó–∞–ø—Ä–æ—Å–æ–≤ —Å–µ–≥–æ–¥–Ω—è:* {stats['today_requests']}\n"
        f"üë• *–†–µ—Ñ–µ—Ä–∞–ª–æ–≤:* {stats['referrals_count']}\n"
        f"üìù *–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:* {stats['transactions_count']}\n\n"
        f"üìÖ *–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:* {stats['join_date']}"
    )
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=create_main_menu(user_id)
    )

@bot.message_handler(func=lambda msg: msg.text == "üíé –ü—Ä–µ–º–∏—É–º")
def premium_menu(message):
    user_id = message.from_user.id
    stats = get_user_stats(user_id)
    
    premium_info = ""
    if stats['is_premium'] == 1:
        premium_info = f"‚úÖ *–£ –≤–∞—Å –∞–∫—Ç–∏–≤–µ–Ω –ø—Ä–µ–º–∏—É–º –¥–æ:* {stats['premium_expiry']}\n\n"
    
    response = (
        f"{premium_info}"
        f"üíé *–ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞*\n\n"
        f"*–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:*\n"
        f"‚Ä¢ üîì –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤\n"
        f"‚Ä¢ ‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞\n"
        f"‚Ä¢ üéÅ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏\n"
        f"‚Ä¢ üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n\n"
        f"*–°—Ç–æ–∏–º–æ—Å—Ç—å:*\n"
        f"‚Ä¢ 1 –¥–µ–Ω—å - 100 {CURRENCY_NAME}\n"
        f"‚Ä¢ 7 –¥–Ω–µ–π - 500 {CURRENCY_NAME}\n"
        f"‚Ä¢ 30 –¥–Ω–µ–π - 1500 {CURRENCY_NAME}\n\n"
        f"üí∞ *–í–∞—à –±–∞–ª–∞–Ω—Å:* {stats['balance']} {CURRENCY_NAME}"
    )
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=create_premium_menu()
    )

@bot.message_handler(func=lambda msg: msg.text.startswith("üíé") and "–¥–µ–Ω—å" in msg.text)
def buy_premium_1day(message):
    user_id = message.from_user.id
    balance = get_user_balance(user_id)
    
    if balance < PREMIUM_COST_1DAY:
        bot.send_message(
            message.chat.id,
            f"‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤!\n"
            f"üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {balance} {CURRENCY_NAME}\n"
            f"üíé –¢—Ä–µ–±—É–µ—Ç—Å—è: {PREMIUM_COST_1DAY} {CURRENCY_NAME}",
            reply_markup=create_premium_menu()
        )
        return
    
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–¥–ø–∏—Å–∫—É
    c.execute("SELECT premium_expiry FROM users WHERE user_id = ?", (user_id,))
    result = c.fetchone()
    current_expiry = result[0] if result and result[0] else datetime.now()
    
    if isinstance(current_expiry, str):
        current_expiry = datetime.strptime(current_expiry, "%Y-%m-%d %H:%M:%S")
    
    # –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –µ—â–µ –∞–∫—Ç–∏–≤–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º –∫ –Ω–µ–π
    if current_expiry > datetime.now():
        new_expiry = current_expiry + timedelta(days=1)
    else:
        new_expiry = datetime.now() + timedelta(days=1)
    
    # –°–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–∏–Ω—ã
    update_balance(user_id, -PREMIUM_COST_1DAY, "premium", "–ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–º–∏—É–º–∞ –Ω–∞ 1 –¥–µ–Ω—å")
    
    # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—Ä–µ–º–∏—É–º
    c.execute("UPDATE users SET is_premium = 1, premium_expiry = ? WHERE user_id = ?",
              (new_expiry.strftime("%Y-%m-%d %H:%M:%S"), user_id))
    conn.commit()
    conn.close()
    
    bot.send_message(
        message.chat.id,
        f"‚úÖ *–ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!*\n\n"
        f"üíé *–°—Ä–æ–∫:* 1 –¥–µ–Ω—å\n"
        f"üìÖ *–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ:* {new_expiry.strftime('%d.%m.%Y %H:%M')}\n"
        f"üí∞ *–°–ø–∏—Å–∞–Ω–æ:* {PREMIUM_COST_1DAY} {CURRENCY_NAME}\n"
        f"üí≥ *–û—Å—Ç–∞—Ç–æ–∫:* {get_user_balance(user_id)} {CURRENCY_NAME}",
        parse_mode="Markdown",
        reply_markup=create_premium_menu()
    )

@bot.message_handler(func=lambda msg: msg.text == "üìã –ú–æ—è –ø–æ–¥–ø–∏—Å–∫–∞")
def my_subscription(message):
    user_id = message.from_user.id
    stats = get_user_stats(user_id)
    
    if stats['is_premium'] == 1:
        response = (
            f"‚úÖ *–£ –≤–∞—Å –∞–∫—Ç–∏–≤–µ–Ω –ø—Ä–µ–º–∏—É–º!*\n\n"
            f"üíé *–°—Ç–∞—Ç—É—Å:* –ê–∫—Ç–∏–≤–µ–Ω\n"
            f"üìÖ *–ò—Å—Ç–µ–∫–∞–µ—Ç:* {stats['premium_expiry']}\n\n"
            f"*–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:*\n"
            f"‚Ä¢ üîì –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã\n"
            f"‚Ä¢ ‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞\n"
            f"‚Ä¢ üéÅ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏"
        )
    else:
        response = (
            f"‚ùå *–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏*\n\n"
            f"üíé *–°—Ç–∞—Ç—É—Å:* –ù–µ –∞–∫—Ç–∏–≤–µ–Ω\n\n"
            f"*–ü—Ä–∏–æ–±—Ä–µ—Ç–∏—Ç–µ –ø—Ä–µ–º–∏—É–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è:*\n"
            f"‚Ä¢ üîì –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤\n"
            f"‚Ä¢ ‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏\n"
            f"‚Ä¢ üéÅ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π\n\n"
            f"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –≤ –º–µ–Ω—é –≤—ã—à–µ ‚¨ÜÔ∏è"
        )
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=create_premium_menu()
    )

@bot.message_handler(func=lambda msg: msg.text == "üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã")
def tools_menu(message):
    response = (
        f"üõ†Ô∏è *–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã*\n\n"
        f"*–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:*\n"
        f"‚Ä¢ üì± *QR –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä* - —Å–æ–∑–¥–∞–Ω–∏–µ QR –∫–æ–¥–æ–≤\n"
        f"‚Ä¢ üîê *–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ* - MD5, SHA-1, SHA-256, SHA-512\n"
        f"‚Ä¢ üîí *–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è* - –æ—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è\n"
        f"‚Ä¢ üìÑ *Base64* - –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ/–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ\n\n"
        f"–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:"
    )
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=create_tools_menu()
    )

@bot.message_handler(func=lambda msg: msg.text == "üì± QR –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä")
def qr_generator_start(message):
    msg = bot.send_message(
        message.chat.id,
        "üì± *–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä QR –∫–æ–¥–æ–≤*\n\n"
        "–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ —Å—Å—ã–ª–∫—É –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ QR –∫–æ–¥:",
        reply_markup=create_back_button(),
        parse_mode="Markdown"
    )
    bot.register_next_step_handler(msg, qr_generator_process)

def qr_generator_process(message):
    if message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥":
        bot.send_message(message.chat.id, "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:", reply_markup=create_tools_menu())
        return
    
    text = message.text.strip()
    
    bot.send_message(message.chat.id, "üîÑ –ì–µ–Ω–µ—Ä–∏—Ä—É—é QR –∫–æ–¥...")
    
    qr_image = generate_qr_code(text)
    
    if qr_image:
        bot.send_photo(
            message.chat.id,
            qr_image,
            caption=f"‚úÖ *QR –∫–æ–¥ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!*\n\nüìù *–¢–µ–∫—Å—Ç:* `{text[:50]}{'...' if len(text) > 50 else ''}`",
            parse_mode="Markdown",
            reply_markup=create_tools_menu()
        )
    else:
        bot.send_message(
            message.chat.id,
            "‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR –∫–æ–¥–∞",
            reply_markup=create_tools_menu()
        )

@bot.message_handler(func=lambda msg: msg.text == "üîê –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ")
def hash_start(message):
    msg = bot.send_message(
        message.chat.id,
        "üîê *–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞*\n\n"
        "–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:",
        reply_markup=create_back_button(),
        parse_mode="Markdown"
    )
    bot.register_next_step_handler(msg, hash_algorithm_select)

def hash_algorithm_select(message):
    if message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥":
        bot.send_message(message.chat.id, "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:", reply_markup=create_tools_menu())
        return
    
    bot.session_data = {'hash_text': message.text}
    
    msg = bot.send_message(
        message.chat.id,
        "–í—ã–±–µ—Ä–∏—Ç–µ –∞–ª–≥–æ—Ä–∏—Ç–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:",
        reply_markup=create_hash_menu(),
        parse_mode="Markdown"
    )

@bot.callback_query_handler(func=lambda call: call.data.startswith('hash_'))
def hash_process(call):
    algorithm = call.data.split('_')[1]
    text = bot.session_data.get('hash_text', '')
    
    if not text:
        bot.answer_callback_query(call.id, "‚ùå –¢–µ–∫—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return
    
    hashed = hash_text(text, algorithm)
    
    if hashed:
        response = (
            f"üîê *–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ*\n\n"
            f"üìù *–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç:* `{text[:50]}{'...' if len(text) > 50 else ''}`\n"
            f"üîß *–ê–ª–≥–æ—Ä–∏—Ç–º:* {algorithm.upper()}\n"
            f"üîí *–•–µ—à:* `{hashed}`"
        )
    else:
        response = "‚ùå –û—à–∏–±–∫–∞ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è"
    
    bot.edit_message_text(
        chat_id=call.message.chat.id,
        message_id=call.message.message_id,
        text=response,
        parse_mode="Markdown"
    )
    
    time.sleep(1)
    bot.send_message(
        call.message.chat.id,
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=create_tools_menu()
    )

@bot.message_handler(func=lambda msg: msg.text == "üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è")
def password_check_start(message):
    msg = bot.send_message(
        message.chat.id,
        "üîí *–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è*\n\n"
        "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ø–∞—Ä–æ–ª—å –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è):",
        reply_markup=create_back_button(),
        parse_mode="Markdown"
    )
    bot.register_next_step_handler(msg, password_check_process)

def password_check_process(message):
    if message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥":
        bot.send_message(message.chat.id, "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:", reply_markup=create_tools_menu())
        return
    
    password = message.text.strip()
    result = check_password_strength(password)
    
    response = (
        f"üîí *–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è*\n\n"
        f"üìä *–û—Ü–µ–Ω–∫–∞:* {result['score']}/{result['max_score']}\n"
        f"üí™ *–£—Ä–æ–≤–µ–Ω—å:* {result['strength']}\n\n"
        f"*–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:*\n"
    )
    
    for feedback in result['feedback']:
        response += f"{feedback}\n"
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=create_tools_menu()
    )

@bot.message_handler(func=lambda msg: msg.text == "üìÑ Base64 –∫–æ–¥–∏—Ä–æ–≤–∫–∞")
def base64_start(message):
    msg = bot.send_message(
        message.chat.id,
        "üìÑ *Base64 –∫–æ–¥–∏—Ä–æ–≤–∫–∞*\n\n"
        "–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ Base64 –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:",
        reply_markup=create_back_button(),
        parse_mode="Markdown"
    )
    bot.register_next_step_handler(msg, base64_process)

def base64_process(message):
    if message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥":
        bot.send_message(message.chat.id, "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:", reply_markup=create_tools_menu())
        return
    
    text = message.text.strip()
    
    try:
        # –ü—Ä–æ–±—É–µ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å (–ø—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ Base64)
        if re.match(r'^[A-Za-z0-9+/]*={0,2}$', text):
            decoded = base64.b64decode(text).decode('utf-8')
            response = (
                f"üìÑ *Base64 –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ*\n\n"
                f"üîí *–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç:* `{text[:50]}{'...' if len(text) > 50 else ''}`\n"
                f"üîì *–†–µ–∑—É–ª—å—Ç–∞—Ç:* `{decoded[:100]}{'...' if len(decoded) > 100 else ''}`"
            )
        else:
            # –ö–æ–¥–∏—Ä—É–µ–º –≤ Base64
            encoded = base64.b64encode(text.encode('utf-8')).decode('utf-8')
            response = (
                f"üìÑ *Base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ*\n\n"
                f"üîì *–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç:* `{text[:50]}{'...' if len(text) > 50 else ''}`\n"
                f"üîí *–†–µ–∑—É–ª—å—Ç–∞—Ç:* `{encoded[:100]}{'...' if len(encoded) > 100 else ''}`"
            )
    except:
        response = "‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞"
    
    bot.send_message(
        message.chat.id,
        response,
        parse_mode="Markdown",
        reply_markup=create_tools_menu()
    )

@bot.message_handler(func=lambda msg: msg.text == "‚ÑπÔ∏è –ü–æ–º–æ—â—å")
def show_help(message):
    help_text = (
        f"üÜò *–ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞*\n\n"
        
        f"*–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:*\n"
        f"‚Ä¢ üîç *–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ—Ä–∞* - –∞–Ω–∞–ª–∏–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤\n"
        f"‚Ä¢ üìß *–ü—Ä–æ–≤–µ—Ä–∫–∞ email* - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ email\n"
        f"‚Ä¢ üõ†Ô∏è *–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã* - –ø–æ–ª–µ–∑–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã\n\n"
        
        f"*–≠–∫–æ–Ω–æ–º–∏–∫–∞:*\n"
        f"‚Ä¢ üí∞ *–ë–∞–ª–∞–Ω—Å* - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤–∞—à–∏—Ö –∫–æ–∏–Ω–æ–≤\n"
        f"‚Ä¢ üéÅ *–ë–æ–Ω—É—Å—ã* - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±–æ–Ω—É—Å—ã –∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã\n"
        f"‚Ä¢ üíé *–ü—Ä–µ–º–∏—É–º* - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n\n"
        
        f"*–°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥:*\n"
        f"‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ—Ä–∞: {PHONE_CHECK_PRICE} –∫–æ–∏–Ω–æ–≤\n"
        f"‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ email: {EMAIL_CHECK_PRICE} –∫–æ–∏–Ω–æ–≤\n\n"
        
        f"*–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–∏–Ω—ã:*\n"
        f"1. üé∞ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å\n"
        f"2. üé´ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤\n"
        f"3. üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π\n"
        f"4. üíé –ü–æ–∫—É–ø–∫–∞ –ø—Ä–µ–º–∏—É–º–∞\n\n"
        
        f"*–ö–æ–º–∞–Ω–¥—ã:*\n"
        f"/start - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞\n"
        f"/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n"
        f"/stats - –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n\n"
        
        f"*–ü–æ–¥–¥–µ—Ä–∂–∫–∞:*\n"
        f"–ü–æ –≤—Å–µ–º –≤–æ–ø—Ä–æ—Å–∞–º: @osint_master_bot"
    )
    
    bot.send_message(
        message.chat.id,
        help_text,
        parse_mode="Markdown",
        reply_markup=create_main_menu(message.from_user.id)
    )

# –ù–∞–≤–∏–≥–∞—Ü–∏—è
@bot.message_handler(func=lambda msg: msg.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥")
def back_to_main(message):
    bot.send_message(
        message.chat.id,
        "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:",
        reply_markup=create_main_menu(message.from_user.id)
    )

@bot.callback_query_handler(func=lambda call: call.data == "check_subscription")
def check_subscription_callback(call):
    user_id = call.from_user.id
    
    if check_subscription(user_id):
        conn = sqlite3.connect('osint.db')
        c = conn.cursor()
        c.execute("UPDATE users SET subscribed = 1 WHERE user_id = ?", (user_id,))
        conn.commit()
        conn.close()
        
        bot.edit_message_text(
            chat_id=call.message.chat.id,
            message_id=call.message.message_id,
            text="‚úÖ *–í—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å!*\n\n–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –±–æ—Ç–∞.",
            parse_mode="Markdown"
        )
        
        time.sleep(1)
        bot.send_message(
            call.message.chat.id,
            "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
            reply_markup=create_main_menu(user_id)
        )
    else:
        bot.answer_callback_query(call.id, "‚ùå –í—ã –µ—â–µ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª!", show_alert=True)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä—É–≥–∏—Ö callback-–æ–≤
@bot.callback_query_handler(func=lambda call: call.data == "admin_detailed_stats")
def admin_detailed_stats(call):
    conn = sqlite3.connect('osint.db')
    c = conn.cursor()
    
    # –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    c.execute("""SELECT 
                 COUNT(*) as total_users,
                 SUM(CASE WHEN is_premium = 1 THEN 1 ELSE 0 END) as premium_users,
                 SUM(CASE WHEN is_banned = 1 THEN 1 ELSE 0 END) as banned_users,
                 SUM(balance) as total_coins,
                 AVG(balance) as avg_coins,
                 COUNT(DISTINCT referred_by) as users_with_refs,
                 MAX(join_date) as last_join
                 FROM users""")
    
    stats = c.fetchone()
    total_users, premium_users, banned_users, total_coins, avg_coins, users_with_refs, last_join = stats
    
    # –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º
    c.execute("""SELECT DATE(timestamp), COUNT(*) 
                 FROM requests 
                 WHERE timestamp >= DATE('now', '-30 days') 
                 GROUP BY DATE(timestamp) 
                 ORDER BY DATE(timestamp) DESC 
                 LIMIT 7""")
    weekly_activity = c.fetchall()
    
    # –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –±–∞–ª–∞–Ω—Å—É
    c.execute("SELECT user_id, username, first_name, balance FROM users ORDER BY balance DESC LIMIT 5")
    top_users = c.fetchall()
    
    conn.close()
    
    response = f"üìä *–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞*\n\n"
    response += f"üë• *–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:*\n"
    response += f"‚Ä¢ –í—Å–µ–≥–æ: {total_users}\n"
    response += f"‚Ä¢ –ü—Ä–µ–º–∏—É–º: {premium_users} ({premium_users/total_users*100:.1f}%)\n"
    response += f"‚Ä¢ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: {banned_users}\n"
    response += f"‚Ä¢ –° —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏: {users_with_refs}\n\n"
    
    response += f"üí∞ *–≠–∫–æ–Ω–æ–º–∏–∫–∞:*\n"
    response += f"‚Ä¢ –í—Å–µ–≥–æ –∫–æ–∏–Ω–æ–≤: {total_coins or 0}\n"
    response += f"‚Ä¢ –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å: {avg_coins or 0:.0f}\n\n"
    
    response += f"üìà *–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π):*\n"
    for date_str, count in weekly_activity:
        response += f"‚Ä¢ {date_str}: {count} –∑–∞–ø—Ä–æ—Å–æ–≤\n"
    
    response += f"\nüèÜ *–¢–æ–ø-5 –ø–æ –±–∞–ª–∞–Ω—Å—É:*\n"
    for i, (uid, username, name, balance) in enumerate(top_users, 1):
        response += f"{i}. {name or '–ë–µ–∑ –∏–º–µ–Ω–∏'} (@{username or '–Ω–µ—Ç'}) - {balance} –∫–æ–∏–Ω–æ–≤\n"
    
    bot.edit_message_text(
        chat_id=call.message.chat.id,
        message_id=call.message.message_id,
        text=response,
        parse_mode="Markdown"
    )

@bot.callback_query_handler(func=lambda call: call.data == "refresh_stats")
def refresh_stats(call):
    # –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Å—ã–ª–∞–µ–º –∫–æ–º–∞–Ω–¥—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    message = types.Message.de_json(call.message.json)
    message.text = "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞"
    message.from_user = call.from_user
    bot_stats(message)
    
    bot.answer_callback_query(call.id, "‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!")

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == "__main__":
    logger.info("üü¢ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞...")
    init_db()
    
    try:
        bot.polling(none_stop=True, interval=0, timeout=60)
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞: {e}")
    finally:
        logger.info("üî¥ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")